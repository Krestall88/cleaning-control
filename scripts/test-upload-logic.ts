import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// –£–º–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è - –ø—Ä–æ–±–µ–ª—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –ø—É—Å—Ç—ã–º–∏
function normalize(str: string | null | undefined): string | null {
  if (!str) return null;
  const trimmed = str.trim();
  if (trimmed === '' || trimmed === ' ') return null;
  return trimmed;
}

async function testUploadLogic() {
  console.log('üß™ –¢–ï–°–¢ –õ–û–ì–ò–ö–ò –ó–ê–ì–†–£–ó–ö–ò\n');
  
  // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–∞—à–µ–≥–æ Excel
  const testRows = [
    {
      '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞': '¬´–ñ–µ–ª–¥–æ—Ä–ø—Ä–æ–µ–∫—Ç –ü–æ–≤–æ–ª–∂—å—è¬ª - —Ñ–∏–ª–∏–∞–ª–∞ –ê–û ¬´–†–æ—Å–∂–µ–ª–¥–æ—Ä–ø—Ä–æ–µ–∫—Ç¬ª',
      '–∞–¥—Ä–µ—Å': '—É–ª. –ö—Ä–∞—Å–Ω–æ–∞—Ä–º–µ–π—Å–∫–∞—è, 137–±',
      '—É—á–∞—Å—Ç–æ–∫': ' ',
      '–∑–æ–Ω–∞': ' ',
      '–≥—Ä—É–ø–ø–∞ –ø–æ–º–µ—â–µ–Ω–∏–π': '–æ—Ñ–∏—Å–Ω—ã–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è 1302,5 –∫–≤. –º',
      '–ø–æ–º–µ—â–µ–Ω–∏–µ': ' ',
      '–û–±—ä–µ–∫—Ç —É–±–æ—Ä–∫–∏': ' ',
      '—Ç–µ—Ö –∑–∞–¥–∞–Ω–∏–µ': '–º—ã—Ç—å–µ –æ–∫–æ–Ω —Å –¥–≤—É—Ö —Å—Ç–æ—Ä–æ–Ω (–≤ –∫–∞–±–∏–Ω–µ—Ç–∞—Ö 72—à—Ç. (270,93 –∫–≤. –º)',
      '–ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å': '1 —Ä–∞–∑ –≤ 6 –º–µ—Å—è—Ü–µ–≤',
      '–ø—Ä–∏–º–µ—á–∞–Ω–∏—è': '—Å 8.00 –¥–æ 17.00, –ø–æ –º–µ—Å—Ç–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏, 5 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é',
      '–ø–µ—Ä–∏–æ–¥': '',
      '–ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±—ä–µ–∫—Ç–∞ –§–ò–û': '–í–∞—Å–µ–∫–∏–Ω –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á',
      '–¢–µ–ª–µ—Ñ–æ–Ω': '89 277 165 189'
    },
    {
      '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞': '¬´–ñ–µ–ª–¥–æ—Ä–ø—Ä–æ–µ–∫—Ç –ü–æ–≤–æ–ª–∂—å—è¬ª - —Ñ–∏–ª–∏–∞–ª–∞ –ê–û ¬´–†–æ—Å–∂–µ–ª–¥–æ—Ä–ø—Ä–æ–µ–∫—Ç¬ª',
      '–∞–¥—Ä–µ—Å': '—É–ª. –ö—Ä–∞—Å–Ω–æ–∞—Ä–º–µ–π—Å–∫–∞—è, 137–±',
      '—É—á–∞—Å—Ç–æ–∫': ' ',
      '–∑–æ–Ω–∞': ' ',
      '–≥—Ä—É–ø–ø–∞ –ø–æ–º–µ—â–µ–Ω–∏–π': '—Å–∞–Ω—É–∑–ª—ã/—Ç—É–∞–ª–µ—Ç—ã 80,56 –∫–≤. –º',
      '–ø–æ–º–µ—â–µ–Ω–∏–µ': ' ',
      '–û–±—ä–µ–∫—Ç —É–±–æ—Ä–∫–∏': ' ',
      '—Ç–µ—Ö –∑–∞–¥–∞–Ω–∏–µ': '–º—ã—Ç—å–µ –æ–∫–æ–Ω —Å –¥–≤—É—Ö —Å—Ç–æ—Ä–æ–Ω (–≤ —Å–∞–Ω—É–∑–ª–∞—Ö 4 —à—Ç. 17.51 –∫–≤. –º',
      '–ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å': '1 —Ä–∞–∑ –≤ 6 –º–µ—Å—è—Ü–µ–≤',
      '–ø—Ä–∏–º–µ—á–∞–Ω–∏—è': '—Å 8.00 –¥–æ 17.00, –ø–æ –º–µ—Å—Ç–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏, 5 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é',
      '–ø–µ—Ä–∏–æ–¥': '',
      '–ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±—ä–µ–∫—Ç–∞ –§–ò–û': '–í–∞—Å–µ–∫–∏–Ω –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á',
      '–¢–µ–ª–µ—Ñ–æ–Ω': '89 277 165 189'
    }
  ];
  
  console.log('üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª–µ–π:\n');
  
  for (let i = 0; i < testRows.length; i++) {
    const row = testRows[i];
    console.log(`–°—Ç—Ä–æ–∫–∞ ${i + 1}:`);
    
    const siteName = normalize(row['—É—á–∞—Å—Ç–æ–∫']);
    const zoneName = normalize(row['–∑–æ–Ω–∞']);
    let roomGroupName = normalize(row['–≥—Ä—É–ø–ø–∞ –ø–æ–º–µ—â–µ–Ω–∏–π']);
    const roomName = normalize(row['–ø–æ–º–µ—â–µ–Ω–∏–µ']);
    const cleaningObject = normalize(row['–û–±—ä–µ–∫—Ç —É–±–æ—Ä–∫–∏']);
    const techTask = normalize(row['—Ç–µ—Ö –∑–∞–¥–∞–Ω–∏–µ']);
    const frequency = normalize(row['–ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å']) || '–ü–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏';
    const managerName = normalize(row['–ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±—ä–µ–∫—Ç–∞ –§–ò–û']);
    
    console.log(`  –£—á–∞—Å—Ç–æ–∫: ${siteName ? `"${siteName}"` : 'NULL'}`);
    console.log(`  –ó–æ–Ω–∞: ${zoneName ? `"${zoneName}"` : 'NULL'}`);
    console.log(`  –ì—Ä—É–ø–ø–∞ –ø–æ–º–µ—â–µ–Ω–∏–π: ${roomGroupName ? `"${roomGroupName}"` : 'NULL'}`);
    console.log(`  –ü–æ–º–µ—â–µ–Ω–∏–µ: ${roomName ? `"${roomName}"` : 'NULL'}`);
    console.log(`  –û–±—ä–µ–∫—Ç —É–±–æ—Ä–∫–∏: ${cleaningObject ? `"${cleaningObject}"` : 'NULL'}`);
    console.log(`  –¢–µ—Ö –∑–∞–¥–∞–Ω–∏–µ: ${techTask ? `"${techTask}"` : 'NULL'}`);
    console.log(`  –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å: "${frequency}"`);
    console.log(`  –ú–µ–Ω–µ–¥–∂–µ—Ä: ${managerName ? `"${managerName}"` : 'NULL'}`);
    
    // –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏
    console.log('\n  üîÑ –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è:');
    
    if (!siteName && roomGroupName) {
      console.log('  ‚úÖ –£—á–∞—Å—Ç–æ–∫ –ø—É—Å—Ç–æ–π, –Ω–æ –µ—Å—Ç—å –≥—Ä—É–ø–ø–∞ ‚Üí —Å–æ–∑–¥–∞–µ–º "–û—Å–Ω–æ–≤–Ω–æ–π —É—á–∞—Å—Ç–æ–∫"');
      console.log(`  ‚úÖ –ì—Ä—É–ø–ø–∞ "${roomGroupName}" ‚Üí —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∑–æ–Ω–æ–π`);
      roomGroupName = null;
    } else if (!siteName) {
      console.log('  ‚ö†Ô∏è  –£—á–∞—Å—Ç–æ–∫ –ø—É—Å—Ç–æ–π –∏ –≥—Ä—É–ø–ø—ã –Ω–µ—Ç ‚Üí —Ç–µ—Ö–∫–∞—Ä—Ç–∞ –±–µ–∑ –∏–µ—Ä–∞—Ä—Ö–∏–∏');
    }
    
    if (!roomName) {
      console.log('  ‚ö†Ô∏è  –ü–æ–º–µ—â–µ–Ω–∏–µ –ø—É—Å—Ç–æ–µ ‚Üí —Ç–µ—Ö–∫–∞—Ä—Ç–∞ –±–µ–∑ –ø–æ–º–µ—â–µ–Ω–∏—è');
    }
    
    if (!cleaningObject) {
      console.log('  ‚ö†Ô∏è  –û–±—ä–µ–∫—Ç —É–±–æ—Ä–∫–∏ –ø—É—Å—Ç–æ–π ‚Üí —Ç–µ—Ö–∫–∞—Ä—Ç–∞ –±–µ–∑ –æ–±—ä–µ–∫—Ç–∞ —É–±–æ—Ä–∫–∏');
    }
    
    console.log();
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
  console.log('üë§ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞:\n');
  const managerName = '–í–∞—Å–µ–∫–∏–Ω –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á';
  const manager = await prisma.user.findFirst({
    where: {
      name: { equals: managerName, mode: 'insensitive' },
      role: 'MANAGER'
    }
  });
  
  if (manager) {
    console.log(`‚úÖ –ú–µ–Ω–µ–¥–∂–µ—Ä –Ω–∞–π–¥–µ–Ω: ${manager.name}`);
    console.log(`   ID: ${manager.id}`);
    console.log(`   Email: ${manager.email}`);
  } else {
    console.log(`‚ùå –ú–µ–Ω–µ–¥–∂–µ—Ä –ù–ï –Ω–∞–π–¥–µ–Ω: ${managerName}`);
  }
  
  await prisma.$disconnect();
}

testUploadLogic().catch(console.error);
