const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

async function loadObjectFlagman() {
  try {
    console.log('üè¢ –ó–ê–ì–†–£–ó–ö–ê –û–ë–™–ï–ö–¢–ê: –û–û–û ¬´–§–õ–ê–ì–ú–ê–ù¬ª');
    console.log('===================================\n');

    // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º –æ–±—ä–µ–∫—Ç
    const objectName = '–û–ë–©–ï–°–¢–í–û –° –û–ì–†–ê–ù–ò–ß–ï–ù–ù–û–ô –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨–Æ ¬´–§–õ–ê–ì–ú–ê–ù¬ª (–û–û–û ¬´–§–õ–ê–ì–ú–ê–ù¬ª)';
    const objectAddress = '–≥. –°–∞–º–∞—Ä–∞, –û–¥–µ—Å—Å–∫–∏–π –ø–µ—Ä–µ—É–ª–æ–∫, –¥–æ–º 20, –ø–æ–º–µ—â. –ù6';

    let cleaningObject = await prisma.cleaningObject.findFirst({
      where: { 
        OR: [
          { name: objectName },
          { name: { contains: '–§–õ–ê–ì–ú–ê–ù' } },
          { address: { contains: '–û–¥–µ—Å—Å–∫–∏–π –ø–µ—Ä–µ—É–ª–æ–∫' } }
        ]
      }
    });

    if (!cleaningObject) {
      // –ù–∞—Ö–æ–¥–∏–º –∞–¥–º–∏–Ω–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞
      const admin = await prisma.user.findFirst({
        where: { role: 'ADMIN' }
      });

      if (!admin) {
        throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞');
      }

      cleaningObject = await prisma.cleaningObject.create({
        data: {
          name: objectName,
          address: objectAddress,
          description: '–û–û–û ¬´–§–õ–ê–ì–ú–ê–ù¬ª - —Ç–æ—Ä–≥–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –ø–æ –ø—Ä–æ–¥–∞–∂–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è',
          creatorId: admin.id
        }
      });
      console.log(`‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç: ${objectName}`);
    } else {
      console.log(`üìç –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–±—ä–µ–∫—Ç: ${cleaningObject.name}`);
    }

    console.log(`   ID –æ–±—ä–µ–∫—Ç–∞: ${cleaningObject.id}`);
    console.log(`   –ê–¥—Ä–µ—Å: ${cleaningObject.address}\n`);

    // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ ObjectStructure –¥–ª—è —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
    console.log('üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
    const deletedCount = await prisma.objectStructure.deleteMany({
      where: { objectId: cleaningObject.id }
    });
    console.log(`   –£–¥–∞–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${deletedCount.count}\n`);

    // –î–∞–Ω–Ω—ã–µ —Ç–µ—Ö–∫–∞—Ä—Ç –∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
    const techCards = [
      {
        zoneName: '–¢–æ—Ä–≥–æ–≤–∞—è –∑–æ–Ω–∞',
        roomGroupName: '–¢–æ—Ä–≥–æ–≤—ã–µ –ø–ª–æ—â–∞–¥–∏',
        roomName: '–¢–æ—Ä–≥–æ–≤—ã–µ –ø–ª–æ—â–∞–¥–∏ –ø–æ –ø—Ä–æ–¥–∞–∂–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è',
        techCardName: '–ú–æ–π–∫–∞ –≤—Å–µ—Ö –Ω–∞–ø–æ–ª—å–Ω—ã—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤',
        frequency: '2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å',
        workType: '–í–ª–∞–∂–Ω–∞—è —É–±–æ—Ä–∫–∞ –ø–æ–ª–æ–≤',
        period: '–î–≤–∞ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å',
        description: '–ú–æ–π–∫–∞ –≤—Å–µ—Ö –Ω–∞–ø–æ–ª—å–Ω—ã—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤, —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –°–∞–Ω–ü–∏–ù, –ø—Ä–µ–¥—ä—è–≤–ª—è–µ–º—ã–º –∫ —Ç–æ—Ä–≥–æ–≤—ã–º –ø–ª–æ—â–∞–¥–∫–∞–º –ø–æ –ø—Ä–æ–¥–∞–∂–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è',
        notes: '–°–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –°–∞–Ω–ü–∏–ù –¥–ª—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫'
      },
      {
        zoneName: '–°–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è',
        roomGroupName: '–°–∞–Ω—É–∑–ª—ã',
        roomName: '–°–∞–Ω—É–∑–ª—ã (2 —à—Ç)',
        techCardName: '–ú–æ–π–∫–∞ –∏ —Å–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Å–∞–Ω—É–∑–ª–∞—Ö',
        frequency: '2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å',
        workType: '–î–µ–∑–∏–Ω—Ñ–µ–∫—Ü–∏—è',
        period: '–î–≤–∞ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å',
        description: '–ú–æ–π–∫–∞ –∏ —Å–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Å–∞–Ω—É–∑–ª–∞—Ö (2 —à—Ç), —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –°–∞–Ω–ü–∏–ù',
        notes: '–°–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –°–∞–Ω–ü–∏–ù'
      },
      {
        zoneName: '–û–±—â–∏–µ –∑–æ–Ω—ã',
        roomGroupName: '–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–æ–Ω—ã',
        roomName: '–ó–æ–Ω–∞ –æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è',
        techCardName: '–ü—Ä–æ—Ç–∏—Ä–∫–∞ –ø—ã–ª–∏ –≤ –∑–æ–Ω–µ –æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏ –¥–µ–∑–∏–Ω—Ñ–µ–∫—Ü–∏—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π',
        frequency: '2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å',
        workType: '–û–±–µ—Å–ø—ã–ª–∏–≤–∞–Ω–∏–µ',
        period: '–î–≤–∞ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å',
        description: '–ü—Ä–æ—Ç–∏—Ä–∫–∞ –ø—ã–ª–∏ –≤ –∑–æ–Ω–µ –æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–ø–æ–¥–æ–∫–æ–Ω–Ω–∏–∫–∏ –∏ –ø—Ä–æ—á–∏–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏). –ü—Ä–æ—Ç–∏—Ä–∫–∞ —Å—Ç–µ–∫–ª—è–Ω–Ω—ã—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π –¥–≤–µ—Ä–µ–π, –∑–µ—Ä–∫–∞–ª –∏ –¥–µ–∑–∏–Ω—Ñ–µ–∫—Ü–∏—è –≤—Å–µ—Ö –¥–≤–µ—Ä–Ω—ã—Ö —Ä—É—á–µ–∫, —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –°–∞–Ω–ü–∏–ù',
        notes: '–ü–æ–¥–æ–∫–æ–Ω–Ω–∏–∫–∏, —Å—Ç–µ–∫–ª—è–Ω–Ω—ã–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏, –¥–≤–µ—Ä–Ω—ã–µ —Ä—É—á–∫–∏'
      },
      {
        zoneName: '–°–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è',
        roomGroupName: '–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è',
        roomName: '–ë–∞—Ä–Ω–æ-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –∑–æ–Ω–∞, —Å–∫–ª–∞–¥, –∫—É—Ö–Ω—è',
        techCardName: '–ü—Ä–µ–¥–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤—ã–Ω–æ—Å—É –∏ –≤—ã–Ω–æ—Å –º—É—Å–æ—Ä–∞',
        frequency: '2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å',
        workType: '–£–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞',
        period: '–î–≤–∞ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å',
        description: '–ü—Ä–µ–¥–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤—ã–Ω–æ—Å—É –∏ –≤—ã–Ω–æ—Å –º—É—Å–æ—Ä–∞, –∞ –∏–º–µ–Ω–Ω–æ –º—É—Å–æ—Ä–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã –±–∞—Ä–Ω–æ-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –∑–æ–Ω—ã, —Å–∞–Ω—É–∑–ª–æ–≤, –≤—Ö–æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã, –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏–π (—Å–∫–ª–∞–¥, –∫—É—Ö–Ω—è) –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã-–º—É—Å–æ—Ä–æ—Å–±–æ—Ä–Ω–∏–∫–∏',
        notes: '–í—Å–µ –º—É—Å–æ—Ä–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã –æ–±—ä–µ–∫—Ç–∞'
      }
    ];

    console.log('üíæ –ó–ê–ì–†–£–ó–ö–ê –¢–ï–•–ö–ê–†–¢ –í –ë–ê–ó–£ –î–ê–ù–ù–´–•:');
    console.log('==================================');

    let successCount = 0;
    for (const [index, techCard] of techCards.entries()) {
      try {
        await prisma.objectStructure.create({
          data: {
            objectId: cleaningObject.id,
            objectName: cleaningObject.name,
            siteName: '–¢–æ—Ä–≥–æ–≤–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ',
            zoneName: techCard.zoneName,
            roomGroupName: techCard.roomGroupName,
            roomName: techCard.roomName,
            cleaningObjectName: techCard.roomName,
            techCardName: techCard.techCardName,
            frequency: techCard.frequency,
            workType: techCard.workType,
            description: techCard.description,
            notes: techCard.notes,
            period: techCard.period,
            techCardId: `flagman_${index + 1}_${Date.now()}`
          }
        });
        
        successCount++;
        console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–∞ —Ç–µ—Ö–∫–∞—Ä—Ç–∞ ${index + 1}: ${techCard.techCardName}`);
        
      } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–µ—Ö–∫–∞—Ä—Ç—ã ${index + 1}:`, error.message);
      }
    }

    console.log('\nüìà –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:');
    console.log('========================');
    console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${successCount}`);
    console.log(`üìä –í—Å–µ–≥–æ —Ç–µ—Ö–∫–∞—Ä—Ç: ${techCards.length}`);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞
    const finalCheck = await prisma.objectStructure.findMany({
      where: { objectId: cleaningObject.id }
    });

    console.log(`üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤ –ë–î ${finalCheck.length} —Ç–µ—Ö–∫–∞—Ä—Ç`);

    console.log('\n‚úÖ –ó–ê–ì–†–£–ó–ö–ê –û–û–û ¬´–§–õ–ê–ì–ú–ê–ù¬ª –ó–ê–í–ï–†–®–ï–ù–ê!');
    console.log(`üè¢ –û–±—ä–µ–∫—Ç ID: ${cleaningObject.id}`);
    console.log('üìã –ì–æ—Ç–æ–≤ –∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—é —á–µ–∫-–ª–∏—Å—Ç–æ–≤');

  } catch (error) {
    console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);
  } finally {
    await prisma.$disconnect();
  }
}

loadObjectFlagman();
