# üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è: –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç–µ–π —Ä–∞—Å—Ö–æ–¥–æ–≤

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –ë–î** (`prisma/schema.prisma`)

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏:

#### `ExpenseCategory` - –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å—Ç–∞—Ç–µ–π —Ä–∞—Å—Ö–æ–¥–æ–≤
```prisma
- id, name, description
- isActive, sortOrder
- –°–≤—è–∑–∏: limits[], expenses[]
```

#### `ExpenseCategoryLimit` - –õ–∏–º–∏—Ç—ã –ø–æ —Å—Ç–∞—Ç—å—è–º –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤
```prisma
- amount, periodType (DAILY/MONTHLY/SEMI_ANNUAL/ANNUAL)
- month, year (–¥–ª—è MONTHLY)
- startDate, endDate (–¥–ª—è SEMI_ANNUAL, ANNUAL)
- –°–≤—è–∑–∏: object, category, setBy
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∞ `InventoryExpense`
```prisma
+ categoryId - —Å–≤—è–∑—å —Å–æ —Å—Ç–∞—Ç—å–µ–π —Ä–∞—Å—Ö–æ–¥–∞
+ category - —Å–≤—è–∑—å —Å ExpenseCategory
```

### 2. **–ù–æ–≤—ã–π enum `ExpensePeriodType`**
```
DAILY        - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ª–∏–º–∏—Ç
MONTHLY      - –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ª–∏–º–∏—Ç  
SEMI_ANNUAL  - –†–∞–∑ –≤ 6 –º–µ—Å—è—Ü–µ–≤
ANNUAL       - –ì–æ–¥–æ–≤–æ–π –ª–∏–º–∏—Ç
```

### 3. **–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**

1. –•–∏–º–∏—è, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏
2. –¢–µ–ª–µ–∂–∫–∏
3. –°–ø–µ—Ü–æ–¥–µ–∂–¥–∞
4. –ü–æ–∫—É–ø–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
5. –†–µ–º–æ–Ω—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
6. –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∫–Ω–∏–∂–∫–∏
7. –ì–°–ú
8. –í—ã–∑–æ–≤ —Ç–µ—Ö–Ω–∏–∫–∏ –≤ –∑–∏–º–Ω–∏–π –ø–µ—Ä–∏–æ–¥
9. –†–µ–∞–≥–µ–Ω—Ç—ã
10. –î–∏—Å–ø–µ–Ω—Å–µ—Ä—ã

## üîß –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î

```bash
npx prisma migrate deploy
```

–ò–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```bash
npx prisma migrate dev
```

### –®–∞–≥ 2: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client

```bash
npx prisma generate
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

```bash
npx ts-node prisma/seeds/expense-categories.ts
```

## üìä –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –•–∏–º–∏—è —Å –¥–≤—É–º—è –ª–∏–º–∏—Ç–∞–º–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:**
- –õ–∏–º–∏—Ç –Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –∑–∞–∫—É–ø–∫—É —Ö–∏–º–∏–∏
- –õ–∏–º–∏—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∞–ª—å–Ω—É—é —É–±–æ—Ä–∫—É (—Ä–∞–∑ –≤ 6 –º–µ—Å—è—Ü–µ–≤)

**–†–µ—à–µ–Ω–∏–µ:**

–°–æ–∑–¥–∞–µ–º **–¥–≤–∞ –ª–∏–º–∏—Ç–∞** –¥–ª—è –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–•–∏–º–∏—è, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏":

#### –õ–∏–º–∏—Ç 1: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∑–∞–∫—É–ø–∫–∞
```typescript
{
  objectId: "...",
  categoryId: "—Ö–∏–º–∏—è_id",
  periodType: "DAILY",
  amount: 1000,
  isRecurring: true
}
```

#### –õ–∏–º–∏—Ç 2: –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–∞—è —É–±–æ—Ä–∫–∞
```typescript
{
  objectId: "...",
  categoryId: "—Ö–∏–º–∏—è_id",
  periodType: "SEMI_ANNUAL",
  amount: 15000,
  startDate: "2025-01-01",
  endDate: "2025-06-30"
}
```

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å

‚úÖ **–î–ª—è –ª—é–±–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞** –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–∏ –ª–∏–º–∏—Ç—ã
‚úÖ **–î–ª—è –ª—é–±–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏–º–∏—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏
‚úÖ **–õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å** –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚úÖ **–ì–∏–±–∫–∏–µ –ø–µ—Ä–∏–æ–¥—ã** - –æ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –¥–æ –≥–æ–¥–æ–≤—ã—Ö

## üé® –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–∞–ª—å—à–µ

### 1. API Endpoints

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (–ê–¥–º–∏–Ω)
- `GET /api/expense-categories` - —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `POST /api/expense-categories` - —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
- `PATCH /api/expense-categories/:id` - –æ–±–Ω–æ–≤–∏—Ç—å
- `DELETE /api/expense-categories/:id` - —É–¥–∞–ª–∏—Ç—å

#### –õ–∏–º–∏—Ç—ã (–ê–¥–º–∏–Ω)
- `GET /api/objects/:id/expense-limits` - –ª–∏–º–∏—Ç—ã –æ–±—ä–µ–∫—Ç–∞
- `POST /api/objects/:id/expense-limits` - —Å–æ–∑–¥–∞—Ç—å –ª–∏–º–∏—Ç
- `PATCH /api/expense-limits/:id` - –æ–±–Ω–æ–≤–∏—Ç—å
- `DELETE /api/expense-limits/:id` - —É–¥–∞–ª–∏—Ç—å

#### –†–∞—Å—Ö–æ–¥—ã (–ú–µ–Ω–µ–¥–∂–µ—Ä)
- `GET /api/objects/:id/expenses` - —Ä–∞—Å—Ö–æ–¥—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- `POST /api/objects/:id/expenses` - –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ (+ –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- `GET /api/expenses/stats/:objectId` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

### 2. UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- `ExpenseCategoriesManager.tsx` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- `ObjectExpenseLimitsSettings.tsx` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞

#### –ú–µ–Ω–µ–¥–∂–µ—Ä
- –û–±–Ω–æ–≤–∏—Ç—å `InventoryExpenseForm.tsx` - –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –û–±–Ω–æ–≤–∏—Ç—å `InventoryDashboard.tsx` - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–±–∏–≤–∫—É –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

#### –û–±—â–µ–µ
- `ExpenseCategoryStats.tsx` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `ExpenseLimitProgress.tsx` - –ø—Ä–æ–≥—Ä–µ—Å—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–∏–º–∏—Ç–∞

### 3. –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤

```typescript
// –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞—Å—Ö–æ–¥–∞
async function checkExpenseLimit(
  objectId: string,
  categoryId: string,
  amount: number,
  date: Date
) {
  // –ù–∞–π—Ç–∏ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –æ–±—ä–µ–∫—Ç–∞
  const limits = await prisma.expenseCategoryLimit.findMany({
    where: {
      objectId,
      categoryId,
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–∏–æ–¥
    }
  });

  // –ü–æ—Å—á–∏—Ç–∞—Ç—å —Ç–µ–∫—É—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ –ø–µ—Ä–∏–æ–¥
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏ –ª–∏–º–∏—Ç
  // –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
}
```

## üìà –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞

```typescript
// 1. –•–∏–º–∏—è - –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
await prisma.expenseCategoryLimit.create({
  data: {
    objectId: "obj_123",
    categoryId: "cat_chemistry",
    periodType: "DAILY",
    amount: 1000,
    isRecurring: true,
    setById: "admin_id"
  }
});

// 2. –•–∏–º–∏—è - –≥–µ–Ω–µ—Ä–∞–ª—å–Ω–∞—è —É–±–æ—Ä–∫–∞
await prisma.expenseCategoryLimit.create({
  data: {
    objectId: "obj_123",
    categoryId: "cat_chemistry",
    periodType: "SEMI_ANNUAL",
    amount: 15000,
    startDate: new Date("2025-01-01"),
    endDate: new Date("2025-06-30"),
    setById: "admin_id"
  }
});

// 3. –°–ø–µ—Ü–æ–¥–µ–∂–¥–∞ - –µ–∂–µ–º–µ—Å—è—á–Ω–æ
await prisma.expenseCategoryLimit.create({
  data: {
    objectId: "obj_123",
    categoryId: "cat_uniform",
    periodType: "MONTHLY",
    amount: 5000,
    month: 11,
    year: 2025,
    isRecurring: true,
    setById: "admin_id"
  }
});
```

### –ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º

```typescript
// –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç —Ä–∞—Å—Ö–æ–¥
await prisma.inventoryExpense.create({
  data: {
    objectId: "obj_123",
    categoryId: "cat_chemistry", // –í—ã–±—Ä–∞–ª –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    amount: 500,
    description: "–ú–æ—é—â–µ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ",
    month: 11,
    year: 2025,
    recordedById: "manager_id"
  }
});

// –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –ª–∏–º–∏—Ç—ã
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```typescript
// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ –∑–∞ –º–µ—Å—è—Ü
const stats = await prisma.inventoryExpense.groupBy({
  by: ['categoryId'],
  where: {
    objectId: "obj_123",
    month: 11,
    year: 2025
  },
  _sum: {
    amount: true
  }
});

// –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–ª—É—á–∏—Ç—å –ª–∏–º–∏—Ç –∏ –ø–æ—Å—á–∏—Ç–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
   - –°—Ç–∞—Ä–∞—è –º–æ–¥–µ–ª—å `InventoryLimit` —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
   - –°—Ç–∞—Ä—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

2. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ª–∏–º–∏—Ç–æ–≤**
   - –û–¥–∏–Ω –æ–±—ä–µ–∫—Ç + –æ–¥–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è + –æ–¥–∏–Ω —Ç–∏–ø –ø–µ—Ä–∏–æ–¥–∞ + –º–µ—Å—è—Ü/–≥–æ–¥ = —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
   - –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤**
   - –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞—Å—Ö–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)

4. **–û—Ç—á–µ—Ç—ã**
   - –û–±—â–∏–π –≤–∏–¥: —Å—É–º–º–∞ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –î–µ—Ç–∞–ª—å–Ω—ã–π –≤–∏–¥: —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
3. üîÑ –°–æ–∑–¥–∞—Ç—å API endpoints
4. üîÑ –°–æ–∑–¥–∞—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
5. üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–æ—Ä–º—ã
6. üîÑ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ª–∏–º–∏—Ç–æ–≤
7. üîÑ –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏, –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- `docs/EXPENSE_CATEGORIES_GUIDE.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `prisma/schema.prisma` - —Å—Ö–µ–º–∞ –ë–î
