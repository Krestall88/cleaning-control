# –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê: –ö–ê–õ–ï–ù–î–ê–†–¨ –ó–ê–î–ê–ß

## üéØ –ö–û–ù–¶–ï–ü–¶–ò–Ø
–ó–∞–º–µ–Ω—è–µ–º —Å–∏—Å—Ç–µ–º—É —á–µ–∫-–ª–∏—Å—Ç–æ–≤ –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–¥–∞—á, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç–∏ —Ç–µ—Ö–∫–∞—Ä—Ç –∏ –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

## üìä –ù–û–í–ê–Ø –ú–û–î–ï–õ–¨ –î–ê–ù–ù–´–•

### TaskExecution - –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
```prisma
model TaskExecution {
  id          String   @id @default(cuid())
  
  // –°–≤—è–∑–∏
  techCardId  String
  techCard    TechCard @relation(fields: [techCardId], references: [id], onDelete: Cascade)
  objectId    String
  object      CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)
  managerId   String
  manager     User @relation(fields: [managerId], references: [id])
  
  // –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  scheduledFor DateTime  // –ö–æ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
  dueDate      DateTime  // –ö—Ä–∞–π–Ω–∏–π —Å—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  
  // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
  executedAt   DateTime? // –ö–æ–≥–¥–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
  status       TaskExecutionStatus @default(PENDING)
  
  // –û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
  comment      String?   // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä–∞
  photos       String[]  // –ú–∞—Å—Å–∏–≤ URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
  
  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([managerId, scheduledFor])
  @@index([objectId, scheduledFor])
  @@index([status, scheduledFor])
}

enum TaskExecutionStatus {
  PENDING     // –û–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  COMPLETED   // –í—ã–ø–æ–ª–Ω–µ–Ω–æ
  OVERDUE     // –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ
  SKIPPED     // –ü—Ä–æ–ø—É—â–µ–Ω–æ (—Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º)
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π
```prisma
// –î–æ–±–∞–≤–ª—è–µ–º –∫ TechCard –ø–æ–ª—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç–∏
model TechCard {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  
  // –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
  frequencyDays    Int?      // –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö (1=–µ–∂–µ–¥–Ω–µ–≤–Ω–æ, 7=–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ, 30=–µ–∂–µ–º–µ—Å—è—á–Ω–æ)
  preferredTime    String?   // –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è "09:00"
  maxDelayHours    Int?      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ —á–∞—Å–∞—Ö
  
  // –°–≤—è–∑—å —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è–º–∏
  executions       TaskExecution[]
}

// –î–æ–±–∞–≤–ª—è–µ–º –∫ CleaningObject –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
model CleaningObject {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  
  // –ù–æ–≤—ã–µ –ø–æ–ª—è
  taskExecutions   TaskExecution[]
}
```

## üîÑ –ê–õ–ì–û–†–ò–¢–ú –†–ê–°–ß–ï–¢–ê –ê–ö–¢–£–ê–õ–¨–ù–´–• –ó–ê–î–ê–ß

### –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–¥–∞—á –Ω–∞ –¥–µ–Ω—å:
1. **–ë–µ—Ä–µ–º –≤—Å–µ —Ç–µ—Ö–∫–∞—Ä—Ç—ã –æ–±—ä–µ–∫—Ç–æ–≤ –º–µ–Ω–µ–¥–∂–µ—Ä–∞**
2. **–î–ª—è –∫–∞–∂–¥–æ–π —Ç–µ—Ö–∫–∞—Ä—Ç—ã:**
   - –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (TaskExecution)
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π
   - –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å (PENDING/OVERDUE)

### –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞:
```javascript
function calculateNextDueDate(techCard, lastExecution) {
  const baseDate = lastExecution?.executedAt || techCard.createdAt;
  const nextDate = addDays(baseDate, techCard.frequencyDays);
  
  // –£—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ –æ–±—ä–µ–∫—Ç–∞
  return adjustToWorkingDay(nextDate, techCard.object.workingDays);
}

function getTaskStatus(dueDate, maxDelayHours) {
  const now = new Date();
  const maxDate = addHours(dueDate, maxDelayHours || 24);
  
  if (now > maxDate) return 'OVERDUE';
  if (now >= dueDate) return 'PENDING';
  return 'UPCOMING';
}
```

## üì± –ò–ù–¢–ï–†–§–ï–ô–° –ú–ï–ù–ï–î–ñ–ï–†–ê

### –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω "–ú–æ–∏ –∑–∞–¥–∞—á–∏"
```
üìÖ –°–µ–≥–æ–¥–Ω—è (22.10.2025)

üî• –ü–†–û–°–†–û–ß–ï–ù–û (2)
‚îú‚îÄ üìç –¢–¶ –ú–µ–ª–æ–¥–∏—è
‚îÇ  ‚îî‚îÄ –ú—ã—Ç—å–µ –ø–æ–ª–æ–≤ 1 —ç—Ç–∞–∂–∞ (–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ 2—á)
‚îî‚îÄ üìç –û—Ñ–∏—Å –ê–ª—å—Ñ–∞  
   ‚îî‚îÄ –£–±–æ—Ä–∫–∞ —Å–∞–Ω—É–∑–ª–æ–≤ (–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ 30–º–∏–Ω)

‚ö° –°–ï–ì–û–î–ù–Ø (5)
‚îú‚îÄ üìç –¢–¶ –ú–µ–ª–æ–¥–∏—è
‚îÇ  ‚îú‚îÄ –ü—Ä–æ—Ç–∏—Ä–∫–∞ –≤–∏—Ç—Ä–∏–Ω (–¥–æ 15:00)
‚îÇ  ‚îî‚îÄ –í—ã–Ω–æ—Å –º—É—Å–æ—Ä–∞ (–¥–æ 18:00)
‚îî‚îÄ üìç –û—Ñ–∏—Å –ê–ª—å—Ñ–∞
   ‚îú‚îÄ –ú—ã—Ç—å–µ –æ–∫–æ–Ω (–¥–æ 16:00)
   ‚îî‚îÄ –£–±–æ—Ä–∫–∞ –∫–∞–±–∏–Ω–µ—Ç–æ–≤ (–¥–æ 17:00)

üìã –ù–ê –ù–ï–î–ï–õ–ï (8)
‚îú‚îÄ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ (3)
‚îî‚îÄ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ (5)

üëÄ –ó–ê–í–¢–†–ê (3)
‚îî‚îÄ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
```

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç–∏:
- **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ** - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
- **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ** - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –Ω–∞—á–∞–ª–µ –Ω–µ–¥–µ–ª–∏
- **–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ** - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –Ω–∞—á–∞–ª–µ –º–µ—Å—è—Ü–∞
- **–†–∞–∑–æ–≤—ã–µ** - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ –¥–∞—Ç–µ

## üé® UI –ö–û–ú–ü–û–ù–ï–ù–¢–´

### TaskCalendarView - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
```typescript
interface TaskCalendarProps {
  managerId: string;
  date: Date;
  view: 'today' | 'tomorrow' | 'week';
}

interface TaskGroup {
  title: string;
  priority: 'overdue' | 'today' | 'upcoming';
  tasks: CalendarTask[];
}

interface CalendarTask {
  id: string;
  techCard: TechCard;
  object: CleaningObject;
  scheduledFor: Date;
  dueDate: Date;
  status: TaskExecutionStatus;
  lastExecution?: TaskExecution;
}
```

### TaskExecutionModal - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
```typescript
interface TaskExecutionModalProps {
  task: CalendarTask;
  onComplete: (data: ExecutionData) => void;
}

interface ExecutionData {
  comment?: string;
  photos?: File[];
  status: 'COMPLETED' | 'SKIPPED';
}
```

## üîß API –≠–ù–î–ü–û–ò–ù–¢–´

### GET /api/tasks/calendar
```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
interface CalendarRequest {
  managerId?: string;  // –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ - —Ç–æ–ª—å–∫–æ –µ–≥–æ –∑–∞–¥–∞—á–∏
  objectId?: string;   // –§–∏–ª—å—Ç—Ä –ø–æ –æ–±—ä–µ–∫—Ç—É
  date: string;        // –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
  view: 'day' | 'week' | 'month';
}

interface CalendarResponse {
  overdue: CalendarTask[];
  today: CalendarTask[];
  upcoming: CalendarTask[];
  weekly: CalendarTask[];
  monthly: CalendarTask[];
}
```

### POST /api/tasks/execute
```typescript
// –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
interface ExecuteTaskRequest {
  techCardId: string;
  objectId: string;
  scheduledFor: string;
  status: 'COMPLETED' | 'SKIPPED';
  comment?: string;
  photos?: string[];
}
```

### GET /api/tasks/preview
```typescript
// –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞—á
interface PreviewRequest {
  managerId: string;
  date: string;  // –î–∞—Ç–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
}
```

## üìä –ü–ê–ù–ï–õ–¨ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è** - –∫—Ç–æ —á—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–µ–π—á–∞—Å
- **–ü—Ä–æ—Å—Ä–æ—á–∫–∏** - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º/–æ–±—ä–µ–∫—Ç–∞–º
- **–¢—Ä–µ–Ω–¥—ã** - –¥–∏–Ω–∞–º–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- **–°–æ–±–ª—é–¥–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç–∏** - –≥—Ä–∞—Ñ–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–ö–∞—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã** - –∞–Ω–∞–ª–∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ —Ñ–æ—Ç–æ
- **–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–æ–Ω—ã** - —á–∞—Å—Ç–æ –ø—Ä–æ—Å—Ä–æ—á–∏–≤–∞–µ–º—ã–µ –∑–∞–¥–∞—á–∏

## üöÄ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ì–û –ü–û–î–•–û–î–ê

### ‚úÖ –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞:
- –í–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –ü–æ–Ω–∏–º–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ —Å—Ä–æ–∫–∏
- –ü—Ä–æ—Å—Ç–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–æ–≤

### ‚úÖ –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
- –†–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–∫
- –ì–∏–±–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã
- –ú–∏–Ω–∏–º—É–º "–º—É—Å–æ—Ä–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

### ‚úÖ –î–ª—è —Å–∏—Å—Ç–µ–º—ã:
- –í —Ä–∞–∑—ã –º–µ–Ω—å—à–µ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –õ–µ–≥–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
