const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

console.log('üè• –î–û–ë–ê–í–õ–ï–ù–ò–ï –ú–ï–î–ò–¶–ò–ù–ê –ê–õ–¨–§–ê–°–¢–†–ê–•–û–í–ê–ù–ò–Ø –ú–ï–î–ê–° - –°–ê–ù–£–ó–õ–´');
console.log('=====================================================');

// –¢–µ—Ö–∫–∞—Ä—Ç—ã –¥–ª—è —Å–∞–Ω—É–∑–ª–æ–≤ (—Ç–µ–∫—É—â–∞—è —É–±–æ—Ä–∫–∞)
function getSanitaryTechCards() {
  return [
    {
      name: "–í—ã–Ω–æ—Å –º—É—Å–æ—Ä–∞ –∏–∑ –µ–º–∫–æ—Å—Ç–µ–π",
      type: "CLEANING",
      description: "–í—ã–Ω–æ—Å –º—É—Å–æ—Ä–∞ (–æ—Ç—Ö–æ–¥—ã –∫–ª–∞—Å—Å–∞ –ê (–±—ã—Ç–æ–≤—ã–µ)) –∏–∑ –∑–¥–∞–Ω–∏—è –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –æ—Ç–≤–µ–¥–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞, –ø—Ä–æ—Ç–∏—Ä–∞–Ω–∏–µ —ë–º–∫–æ—Å—Ç–∏, —Å–º–µ–Ω–∞ –ø–∞–∫–µ—Ç–æ–≤ –ø–æ –º–µ—Ä–µ –∏—Ö –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è. –ö–∞–∂–¥—ã–π —á–∞—Å –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∫–ª–∏–Ω–∏–∫–∏ —Å –æ—Ç–º–µ—Ç–∫–æ–π –≤ –ª–∏—Å—Ç–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
      frequency: "DAILY"
    },
    {
      name: "–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –¥–∏—Å–ø–µ–Ω—Å–µ—Ä–æ–≤ –¥–ª—è —Ä–∞—Å—Ö–æ–¥–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",
      type: "MAINTENANCE",
      description: "–£–¥–∞–ª–µ–Ω–∏–µ —Å–ª–µ–¥–æ–≤ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π, –∑–∞–ø—Ä–∞–≤–∫–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –¥–æ–∑–∞–ø—Ä–∞–≤–∫–∞. –ö–∞–∂–¥—ã–π —á–∞—Å, –∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
      frequency: "DAILY"
    },
    {
      name: "–£–±–æ—Ä–∫–∞ —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∏",
      type: "CLEANING",
      description: "–í–ª–∞–∂–Ω–∞—è —É–±–æ—Ä–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∏ –≤–Ω–µ—à–Ω–∏—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π —É–Ω–∏—Ç–∞–∑–æ–≤, –±–∏–¥–µ, —Ä–∞–∫–æ–≤–∏–Ω, –∫—Ä—ã—à–µ–∫ —É–Ω–∏—Ç–∞–∑–æ–≤, –∫—Ä–µ–ø–ª–µ–Ω–∏–π, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π. –ö–∞–∂–¥—ã–π —á–∞—Å –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∫–ª–∏–Ω–∏–∫–∏ —Å –æ—Ç–º–µ—Ç–∫–æ–π –≤ –ª–∏—Å—Ç–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
      frequency: "DAILY"
    },
    {
      name: "–£–±–æ—Ä–∫–∞ –∑–µ—Ä–∫–∞–ª –∏ —Å—Ç–µ–∫–ª—è–Ω–Ω—ã—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π",
      type: "CLEANING",
      description: "–£–¥–∞–ª–µ–Ω–∏–µ —Å–ª–µ–¥–æ–≤ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π —Å –∑–µ—Ä–∫–∞–ª –∏ —Å—Ç–µ–∫–ª—è–Ω–Ω—ã—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π. 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
      frequency: "DAILY"
    },
    {
      name: "–£–±–æ—Ä–∫–∞ –∫—Ä–∞–Ω–æ–≤ –∏ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π",
      type: "CLEANING",
      description: "–í–ª–∞–∂–Ω–∞—è —É–±–æ—Ä–∫–∞ –∫—Ä–∞–Ω–æ–≤ –∏ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π. –ö–∞–∂–¥—ã–π —á–∞—Å –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∫–ª–∏–Ω–∏–∫–∏ —Å –æ—Ç–º–µ—Ç–∫–æ–π –≤ –ª–∏—Å—Ç–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
      frequency: "DAILY"
    },
    {
      name: "–í–ª–∞–∂–Ω–∞—è —É–±–æ—Ä–∫–∞ –ø–æ–ª–∞",
      type: "CLEANING",
      description: "–í–ª–∞–∂–Ω–∞—è —É–±–æ—Ä–∫–∞ —Ç–≤–µ—Ä–¥–æ–≥–æ –ø–æ–ª–∞, —É–¥–∞–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π. –ö–∞–∂–¥—ã–π —á–∞—Å –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∫–ª–∏–Ω–∏–∫–∏ —Å –æ—Ç–º–µ—Ç–∫–æ–π –≤ –ª–∏—Å—Ç–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
      frequency: "DAILY"
    },
    {
      name: "–î–µ–∑–æ–¥–æ—Ä–∞—Ü–∏—è –ø–æ–º–µ—â–µ–Ω–∏–π",
      type: "MAINTENANCE",
      description: "–ü—Ä–æ–≤–µ—Ä–∫–∞/–∑–∞–º–µ–Ω–∞ –Ω–∞–ª–∏—á–∏—è –æ—Å–≤–µ–∂–∏—Ç–µ–ª–µ–π –≤–æ–∑–¥—É—Ö–∞. –ü–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
      frequency: "WEEKLY"
    },
    {
      name: "–£–±–æ—Ä–∫–∞ —Å—Ç–µ–Ω –∏ –ø–ª–∏–Ω—Ç—É—Å–æ–≤",
      type: "CLEANING",
      description: "–í–ª–∞–∂–Ω–∞—è —É–±–æ—Ä–∫–∞ —Å—Ç–µ–Ω –∏ –ø–ª–∏–Ω—Ç—É—Å–æ–≤. –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
      frequency: "DAILY"
    },
    {
      name: "–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Ç—É–∞–ª–µ—Ç–Ω—ã—Ö –µ—Ä—à–∏–∫–æ–≤",
      type: "CLEANING",
      description: "–¢—â–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ–º—ã–≤–∞–Ω–∏–µ —Ç—É–∞–ª–µ—Ç–Ω—ã—Ö –µ—Ä—à–∏–∫–æ–≤ –∏ –µ–º–∫–æ—Å—Ç–µ–π –¥–ª—è –Ω–∏—Ö. –ï–∂–µ–¥–Ω–µ–≤–Ω–æ, –∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
      frequency: "DAILY"
    },
    {
      name: "–£–±–æ—Ä–∫–∞ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–µ—à–µ—Ç–æ–∫ –∏ —Ç—Ä—É–±",
      type: "CLEANING",
      description: "–£–¥–∞–ª–µ–Ω–∏–µ –ø—ã–ª–∏ –∏ –≥—Ä—è–∑–∏ —Å –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–µ—à–µ—Ç–æ–∫ –∏ —Ç—Ä—É–±. –ü–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –Ω–æ –Ω–µ —Ä–µ–∂–µ 1 (–æ–¥–Ω–æ–≥–æ) —Ä–∞–∑–∞ –≤ –º–µ—Å—è—Ü",
      frequency: "MONTHLY"
    }
  ];
}

async function createMedASSanitary() {
  try {
    console.log('\nüèóÔ∏è –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –ú–µ–¥–∏—Ü–∏–Ω–∞ –ê–ª—å—Ñ–∞–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –ú–µ–¥–ê–°...');

    // –ü–æ–ª—É—á–∞–µ–º admin –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const adminUser = await prisma.user.findFirst({
      where: { role: 'ADMIN' }
    });

    if (!adminUser) {
      throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é ADMIN');
    }

    // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç
    let dbObject = await prisma.cleaningObject.findFirst({
      where: { name: '–ú–µ–¥–∏—Ü–∏–Ω–∞ –ê–ª—å—Ñ–∞–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –ú–µ–¥–ê–°' }
    });

    if (!dbObject) {
      dbObject = await prisma.cleaningObject.create({
        data: {
          name: '–ú–µ–¥–∏—Ü–∏–Ω–∞ –ê–ª—å—Ñ–∞–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –ú–µ–¥–ê–°',
          address: '–≥. –°–∞–º–∞—Ä–∞, —É–ª.–ì–∞–ª–∞–∫—Ç–∏–æ–Ω–æ–≤—Å–∫–∞—è, 157',
          description: '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä, –ø–ª–æ—â–∞–¥—å 2232,6 –º¬≤',
          timezone: 'Europe/Samara',
          workingHours: JSON.stringify({ start: "07:15", end: "21:00" }),
          workingDays: ["MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY", "SUNDAY"],
          autoChecklistEnabled: true,
          creatorId: adminUser.id
        }
      });
      console.log('   ‚úÖ –û–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–Ω');
    } else {
      console.log('   ‚ÑπÔ∏è –û–±—ä–µ–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
    }

    // –°–æ–∑–¥–∞–µ–º —É—á–∞—Å—Ç–æ–∫
    let site = await prisma.site.findFirst({
      where: { 
        objectId: dbObject.id,
        name: '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä'
      }
    });

    if (!site) {
      site = await prisma.site.create({
        data: {
          name: '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä',
          description: '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –ê–ª—å—Ñ–∞–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –ú–µ–¥–ê–°',
          area: 2232.6,
          objectId: dbObject.id
        }
      });
      console.log('   ‚úÖ –£—á–∞—Å—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω');
    }

    // –°–æ–∑–¥–∞–µ–º –∑–æ–Ω—É –¥–ª—è —Å–∞–Ω—É–∑–ª–æ–≤
    console.log(`\nüöΩ –°–æ–∑–¥–∞–µ–º –∑–æ–Ω—É —Å–∞–Ω—É–∑–ª–æ–≤`);

    let sanitaryZone = await prisma.zone.findFirst({
      where: { 
        siteId: site.id,
        name: '–°–∞–Ω—É–∑–ª—ã'
      }
    });

    if (!sanitaryZone) {
      sanitaryZone = await prisma.zone.create({
        data: {
          name: '–°–∞–Ω—É–∑–ª—ã',
          description: '–°–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ —É–∑–ª—ã –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞',
          area: 150.0, // –ø—Ä–∏–º–µ—Ä–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å–∞–Ω—É–∑–ª–æ–≤
          siteId: site.id
        }
      });
    }

    // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É –ø–æ–º–µ—â–µ–Ω–∏–π
    let roomGroup = await prisma.roomGroup.findFirst({
      where: { 
        zoneId: sanitaryZone.id,
        name: '–ì—Ä—É–ø–ø–∞ —Å–∞–Ω—É–∑–ª–æ–≤'
      }
    });

    if (!roomGroup) {
      roomGroup = await prisma.roomGroup.create({
        data: {
          name: '–ì—Ä—É–ø–ø–∞ —Å–∞–Ω—É–∑–ª–æ–≤',
          description: '–û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞ —Å–∞–Ω–∏—Ç–∞—Ä–Ω—ã—Ö —É–∑–ª–æ–≤',
          area: 150.0,
          zoneId: sanitaryZone.id
        }
      });
    }

    // –°–æ–∑–¥–∞–µ–º –ø–æ–º–µ—â–µ–Ω–∏–µ
    let room = await prisma.room.findFirst({
      where: { 
        objectId: dbObject.id,
        roomGroupId: roomGroup.id,
        name: '–°–∞–Ω—É–∑–ª—ã'
      }
    });

    if (!room) {
      room = await prisma.room.create({
        data: {
          name: '–°–∞–Ω—É–∑–ª—ã',
          description: '–°–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ —É–∑–ª—ã –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞ —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ –≥–∏–≥–∏–µ–Ω–µ',
          area: 150.0,
          objectId: dbObject.id,
          roomGroupId: roomGroup.id
        }
      });
    }

    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Ö–∫–∞—Ä—Ç—ã –¥–ª—è —Å–∞–Ω—É–∑–ª–æ–≤
    const techCards = getSanitaryTechCards();
    let techCardCount = 0;
    
    for (const techCard of techCards) {
      const existingTechCard = await prisma.techCard.findFirst({
        where: {
          roomId: room.id,
          name: techCard.name
        }
      });

      if (!existingTechCard) {
        await prisma.techCard.create({
          data: {
            name: techCard.name,
            workType: techCard.type,
            frequency: techCard.frequency,
            description: techCard.description,
            objectId: dbObject.id,
            roomId: room.id
          }
        });
        techCardCount++;
      }
    }

    console.log(`\n   üìã –°–æ–∑–¥–∞–Ω–æ —Ç–µ—Ö–∫–∞—Ä—Ç –¥–ª—è —Å–∞–Ω—É–∑–ª–æ–≤: ${techCardCount}`);

    return { 
      success: true, 
      objectId: dbObject.id,
      techCardCount,
      objectName: dbObject.name
    };

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    return { success: false, error: error.message };
  }
}

async function main() {
  try {
    const result = await createMedASSanitary();
    
    if (result.success) {
      console.log('\n=====================================================');
      console.log('üéâ –ú–ï–î–ê–° - –°–ê–ù–£–ó–õ–´ –£–°–ü–ï–®–ù–û –î–û–ë–ê–í–õ–ï–ù–´!');
      console.log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:`);
      console.log(`   üìã –¢–µ—Ö–∫–∞—Ä—Ç —Å–æ–∑–¥–∞–Ω–æ: ${result.techCardCount}`);
      console.log(`   üè¢ –û–±—ä–µ–∫—Ç: ${result.objectName}`);
      console.log(`   üè• –¢–∏–ø: –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä`);
      console.log(`   üìê –ü–ª–æ—â–∞–¥—å: 2232,6 –º¬≤`);
      console.log(`   ‚è∞ –ì—Ä–∞—Ñ–∏–∫: 7/7 –ü–Ω-–ü—Ç: 7:15-21:00, –°–±-–í—Å: 8:15-18:00`);
      console.log(`   üöΩ –ó–æ–Ω–∞: –°–∞–Ω—É–∑–ª—ã (—Ç–µ–∫—É—â–∞—è —É–±–æ—Ä–∫–∞)`);
      console.log(`   üßº –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: –ü–æ—á–∞—Å–æ–≤–∞—è —É–±–æ—Ä–∫–∞, –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è`);
      console.log('\nüöÄ –ó–æ–Ω–∞ –≥–æ—Ç–æ–≤–∞ –∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —á–µ–∫-–ª–∏—Å—Ç–æ–≤');
    } else {
      console.log('\n‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –î–û–ë–ê–í–õ–ï–ù–ò–ò –ú–ï–î–ê–° - –°–ê–ù–£–ó–õ–´');
      console.log('–î–µ—Ç–∞–ª–∏:', result.error);
    }
  } catch (error) {
    console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);
  } finally {
    await prisma.$disconnect();
  }
}

main();
