# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–ò–Ø –ó–ê–î–ê–ß

## üêõ –ü–†–û–ë–õ–ï–ú–ê

–ó–∞–¥–∞—á–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∞–ª–∞—Å—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å" –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ:
- –ú–æ–¥–∞–ª–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–ª–∞—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫
- –ó–∞–¥–∞—á–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –≤ —Å–ø–∏—Å–∫–µ "–¢–µ–∫—É—â–∏–µ"
- –§–æ—Ç–æ –Ω–µ –ø–æ—è–≤–ª—è–ª–∏—Å—å –≤ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–∞—Ö
- –í –ª–æ–≥–∞—Ö –Ω–µ –±—ã–ª–æ –æ—à–∏–±–æ–∫

## üîç –ü–†–ò–ß–ò–ù–ê

–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `UnifiedTaskCompletionModal.tsx` –±—ã–ª–æ **–¥–≤–µ –ø—Ä–æ–±–ª–µ–º—ã**:

1. –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å —á–µ—Ä–µ–∑ **–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π** —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/upload`
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—è FormData: `files` –≤–º–µ—Å—Ç–æ `photos`

**–ë—ã–ª–æ:**
```typescript
for (const photo of photos) {
  const formData = new FormData();
  formData.append('files', photo);  // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—è
  
  const uploadResponse = await fetch('/api/upload', {  // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
    method: 'POST',
    body: formData,
  });
}
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```typescript
const formData = new FormData();
photos.forEach(photo => {
  formData.append('photos', photo);  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—è
});

const uploadResponse = await fetch('/api/photos/upload', {  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
  method: 'POST',
  body: formData,
});
```

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### 1. –ò–∑–º–µ–Ω–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ

**–§–∞–π–ª:** `src/components/UnifiedTaskCompletionModal.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω —Å `/api/upload` –Ω–∞ `/api/photos/upload`
- ‚úÖ –ò–º—è –ø–æ–ª—è FormData –∏–∑–º–µ–Ω–µ–Ω–æ —Å `files` –Ω–∞ `photos`
- ‚úÖ –í—Å–µ —Ñ–æ—Ç–æ —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º (–≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–∞)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ `objectId` –≤ FormData
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ `comment` –≤ FormData
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Å—Å–∏–≤–∞ —Ñ–æ—Ç–æ –≤ –æ—Ç–≤–µ—Ç–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏

### 2. –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `src/components/UnifiedCalendarPage.tsx`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- üìù –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–¥–∞—á–µ –∏ —Ñ–æ—Ç–æ

---

## üß™ –ö–ê–ö –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨

### –®–∞–≥ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dev-—Å–µ—Ä–≤–µ—Ä

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
npm run dev
```

### –®–∞–≥ 2: –û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è
2. –ù–∞–π—Ç–∏ –æ–±—ä–µ–∫—Ç "–ñ–µ–ª–¥–æ—Ä –ü–æ–≤–æ–ª–∂—å—è" –∏–ª–∏ "–Ø–Ω–¥–µ–∫—Å"
3. –í—ã–±—Ä–∞—Ç—å –ª—é–±—É—é –∑–∞–¥–∞—á—É –∏–∑ —Å–ø–∏—Å–∫–∞ "–¢–µ–∫—É—â–∏–µ"

### –®–∞–≥ 3: –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É —Å —Ñ–æ—Ç–æ

1. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∑–∞–¥–∞—á—É
2. –û—Ç–∫—Ä–æ–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
3. –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ (1-3 —à—Ç—É–∫–∏)
4. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
5. –ù–∞–∂–∞—Ç—å "–ó–∞–≤–µ—Ä—à–∏—Ç—å"

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**

1. ‚úÖ –ú–æ–¥–∞–ª–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
2. ‚úÖ –ó–∞–¥–∞—á–∞ –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ "–¢–µ–∫—É—â–∏–µ"
3. ‚úÖ –ó–∞–¥–∞—á–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ "–í—ã–ø–æ–ª–Ω–µ–Ω–æ"
4. ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –≤–∏–¥–Ω—ã –ª–æ–≥–∏:
   ```
   üì∏ UNIFIED MODAL: –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ: 1
   üì∏ UNIFIED MODAL: –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ: image.jpg
   üì∏ UNIFIED MODAL: –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: 200
   üì∏ UNIFIED MODAL: –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏: {...}
   ‚úÖ UNIFIED MODAL: –í—Å–µ —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: [...]
   üîç UNIFIED CLIENT: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: {...}
   üì§ UNIFIED CLIENT: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä: {...}
   üì• UNIFIED CLIENT: –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: {status: 200, ok: true}
   ‚úÖ UNIFIED CLIENT: –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: {...}
   ```

5. ‚úÖ –§–æ—Ç–æ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–∞—Ö (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ "–§–æ—Ç–æ–æ—Ç—á–µ—Ç—ã")

---

## üìä –õ–û–ì–ò –î–õ–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò

### –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ:

```
üîç MODAL: –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—ä–µ–∫—Ç–∞: cmgza7quz000pvyxkj8mgwdve
üîç MODAL: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—ä–µ–∫—Ç–∞ –ø–æ–ª—É—á–µ–Ω—ã: {...}
üîç UNIFIED MODAL: –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É: {...}
üîç MODAL: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: {...}
üì∏ UNIFIED MODAL: –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ: 1
üì∏ UNIFIED MODAL: –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ: photo.jpg
üì∏ UNIFIED MODAL: –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: 200
üì∏ UNIFIED MODAL: –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏: {photos: [{url: "..."}]}
‚úÖ UNIFIED MODAL: –í—Å–µ —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ["https://s3.twcstorage.ru/..."]
üîç UNIFIED MODAL: –ì–æ—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏: {...}
üîç UNIFIED CLIENT: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: {...}
üì§ UNIFIED CLIENT: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä: {...}
üì• UNIFIED CLIENT: –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: {status: 200, ok: true}
‚úÖ UNIFIED CLIENT: –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: {...}
```

### –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:

```
üì∏ UNIFIED MODAL: –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ: 1
üì∏ UNIFIED MODAL: –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ: photo.jpg
üì∏ UNIFIED MODAL: –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: 400/500
‚ùå UNIFIED MODAL: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ: {...}
```

### –û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:

```
üì§ UNIFIED CLIENT: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä: {...}
üì• UNIFIED CLIENT: –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: {status: 400/500, ok: false}
‚ùå UNIFIED CLIENT: –û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏: {...}
```

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/photos/upload`

**–ú–µ—Ç–æ–¥:** POST  
**Content-Type:** multipart/form-data

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã FormData:**
- `photos` - —Ñ–∞–π–ª—ã —Ñ–æ—Ç–æ (File[]) - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ
- `taskId` - ID –∑–∞–¥–∞—á–∏ (string)
- `objectId` - ID –æ–±—ä–µ–∫—Ç–∞ (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `comment` - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û—Ç–≤–µ—Ç:**
```json
{
  "photos": [
    {
      "id": "photo-id",
      "url": "https://s3.twcstorage.ru/.../photo.jpg",
      "comment": "...",
      "createdAt": "2025-11-24T..."
    }
  ],
  "message": "–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"
}
```

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/tasks/unified-complete`

**–ú–µ—Ç–æ–¥:** POST  
**Content-Type:** application/json

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "taskId": "task-id",
  "status": "COMPLETED",
  "comment": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
  "photos": ["https://s3.twcstorage.ru/.../photo.jpg"]
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "task": {
    "id": "task-id",
    "status": "COMPLETED",
    "completedAt": "2025-11-24T...",
    "completedBy": {...},
    "completionComment": "...",
    "completionPhotos": [...]
  },
  "message": "–ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞",
  "wasVirtual": false
}
```

---

## üéØ –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û:

1. ‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç API
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ objectId

### üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dev-—Å–µ—Ä–≤–µ—Ä
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å —Ñ–æ—Ç–æ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–æ—Ç–æ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–∞—Ö
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

---

## üìÖ –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 24.11.2025

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ
