{
  "timestamp": "2025-10-27T11:47:41.164Z",
  "schemaContent": "generator client {\n  provider = \"prisma-client-js\"\n}\n\ngenerator erd {\n  provider = \"prisma-erd-generator\"\n  output   = \"../docs/erd.md\"\n  theme    = \"dark\"\n}\n\ndatasource db {\n  provider = \"postgresql\"\n  url      = env(\"DATABASE_URL\")\n}\n\nmodel User {\n  id                       String                  @id @default(cuid())\n  createdAt                DateTime                @default(now())\n  updatedAt                DateTime                @updatedAt\n  email                    String                  @unique\n  name                     String?\n  phone                    String?\n  password                 String\n  role                     Role                    @default(MANAGER)\n  assignedAdditionalTasks  AdditionalTask[]        @relation(\"AssignedAdditionalTasks\")\n  completedAdditionalTasks AdditionalTask[]        @relation(\"CompletedAdditionalTasks\")\n  auditLogs                AuditLog[]\n  completedChecklists      Checklist[]             @relation(\"CompletedChecklists\")\n  createdChecklists        Checklist[]\n  createdObjects           CleaningObject[]        @relation(\"CreatedBy\")\n  managedObjects           CleaningObject[]        @relation(\"ManagedBy\")\n  assignedDeputyAdmins     DeputyAdminAssignment[] @relation(\"AssignedDeputyAdmins\")\n  deputyAdminAssignments   DeputyAdminAssignment[] @relation(\"DeputyAdminAssignments\")\n  inventoryExpenses        InventoryExpense[]      @relation(\"InventoryExpenses\")\n  setInventoryLimits       InventoryLimit[]        @relation(\"SetInventoryLimits\")\n  photoReports             PhotoReport[]\n  createdRequests          Request[]\n  completedTasks           Task[]\n  managedSites             Site[]                  @relation(\"SiteManager\")\n  taskExecutions           TaskExecution[]         @relation(\"TaskExecutions\")\n  createdReportingTasks    ReportingTask[]         @relation(\"CreatedReportingTasks\")\n  assignedReportingTasks   ReportingTask[]         @relation(\"AssignedReportingTasks\")\n  excludedObjects          ExcludedObject[]        @relation(\"ExcludedObjects\")\n  \n  // Новые связи для комментариев и уведомлений\n  adminComments            TaskAdminComment[]      @relation(\"AdminComments\")\n  notifications            Notification[]\n  \n  // Связи для задач отчетности\n  reportingTaskComments    ReportingTaskComment[]  @relation(\"ReportingTaskComments\")\n  reportingTaskAttachments ReportingTaskAttachment[] @relation(\"ReportingTaskAttachments\")\n}\n\nmodel CleaningObject {\n  id                          String                  @id @default(cuid())\n  createdAt                   DateTime                @default(now())\n  updatedAt                   DateTime                @updatedAt\n  name                        String\n  address                     String\n  documents                   Json?\n  timezone                    String?\n  workingHours                Json?\n  workingDays                 String[]\n  autoChecklistEnabled        Boolean                 @default(true)\n  lastChecklistDate           DateTime?\n  requirePhotoForCompletion   Boolean                 @default(false)\n  requireCommentForCompletion Boolean                 @default(false)\n  completionRequirements      Json?\n  creatorId                   String\n  managerId                   String?\n  \n  // Новые поля для многоуровневой структуры\n  totalArea                   Float?                  // Общая площадь объекта\n  description                 String?                 // Описание объекта\n  notes                       String?                 // Примечания к объекту\n  \n  additionalTasks             AdditionalTask[]\n  checklists                  Checklist[]\n  creator                     User                    @relation(\"CreatedBy\", fields: [creatorId], references: [id])\n  manager                     User?                   @relation(\"ManagedBy\", fields: [managerId], references: [id])\n  clientBindings              ClientBinding[]\n  deputyAdminAssignments      DeputyAdminAssignment[] @relation(\"DeputyAdminObjects\")\n  inventoryExpenses           InventoryExpense[]\n  inventoryLimits             InventoryLimit[]\n  photoReports                PhotoReport[]\n  requests                    Request[]\n  rooms                       Room[]\n  techCards                   TechCard[]\n  sites                       Site[]                  // Участки объекта\n  objectStructures            ObjectStructure[]       // Плоская структура\n  taskExecutions              TaskExecution[]         // Выполнения задач\n  reportingTasks              ReportingTask[]         @relation(\"ReportingTasks\") // Задачи отчетности для объекта\n  excludedObjects             ExcludedObject[]        @relation(\"ExcludedObjects\") // Исключения из отчетности\n}\n\nmodel Room {\n  id              String               @id @default(cuid())\n  createdAt       DateTime             @default(now())\n  name            String\n  description     String?\n  area            Float?\n  objectId        String\n  roomGroupId     String?              // Связь с группой помещений\n  \n  checklists      Checklist[]\n  object          CleaningObject       @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  roomGroup       RoomGroup?           @relation(fields: [roomGroupId], references: [id])\n  tasks           Task[]\n  techCards       TechCard[]\n  cleaningObjects CleaningObjectItem[] // Объекты уборки в помещении\n}\n\n// Новая модель Site (Участок)\nmodel Site {\n  id          String         @id @default(cuid())\n  createdAt   DateTime       @default(now())\n  name        String         // Название участка\n  description String?        // Описание участка\n  area        Float?         // Площадь участка\n  comment     String?        // Комментарий к участку (переименовано из areaInfo)\n  objectId    String\n  managerId   String?        // Менеджер участка\n  \n  object      CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  manager     User?          @relation(\"SiteManager\", fields: [managerId], references: [id])\n  zones       Zone[]         // Зоны участка\n}\n\n// Новая модель Zone (Зона)\nmodel Zone {\n  id          String      @id @default(cuid())\n  createdAt   DateTime    @default(now())\n  name        String      // Название зоны\n  description String?     // Описание зоны\n  area        Float?      // Площадь зоны\n  siteId      String\n  \n  site        Site        @relation(fields: [siteId], references: [id], onDelete: Cascade)\n  roomGroups  RoomGroup[] // Группы помещений\n}\n\n// Новая модель RoomGroup (Группа помещений)\nmodel RoomGroup {\n  id          String   @id @default(cuid())\n  createdAt   DateTime @default(now())\n  name        String   // Название группы помещений\n  description String?  // Описание группы\n  area        Float?   // Площадь группы\n  zoneId      String\n  \n  zone        Zone     @relation(fields: [zoneId], references: [id], onDelete: Cascade)\n  rooms       Room[]   // Помещения в группе\n}\n\n// Новая модель CleaningObjectItem (Объект уборки)\nmodel CleaningObjectItem {\n  id          String     @id @default(cuid())\n  createdAt   DateTime   @default(now())\n  name        String     // Название объекта уборки (пол, стены, окна и т.д.)\n  description String?    // Описание объекта уборки\n  roomId      String\n  \n  room        Room       @relation(fields: [roomId], references: [id], onDelete: Cascade)\n  techCards   TechCard[] // Техкарты для этого объекта уборки\n}\n\nmodel TechCard {\n  id                   String                @id @default(cuid())\n  createdAt            DateTime              @default(now())\n  name                 String\n  workType             String\n  frequency            String\n  description          String?\n  objectId             String\n  \n  // Привязка к элементам структуры (иерархическая)\n  siteId               String?               // Участок\n  zoneId               String?               // Зона\n  roomGroupId          String?               // Группа помещений\n  roomId               String?               // Помещение\n  cleaningObjectItemId String?               // Объект уборки\n  \n  // Новые поля для детализации\n  period               String?               // Период (летний/зимний)\n  seasonality          String?               // Сезонность (Общий, Зимний период, Летний период)\n  notes                String?               // Примечания\n  workDetails          String?               // Детальное описание работ\n  \n  // Новые поля для календаря задач\n  frequencyDays        Int?                  // Периодичность в днях (1=ежедневно, 7=еженедельно, 30=ежемесячно)\n  preferredTime        String?               // Предпочтительное время выполнения \"09:00\"\n  maxDelayHours        Int?                  // Максимальная задержка в часах\n  timeSlots            String[]              // Временные промежутки в течение дня [\"09:00-12:00\", \"14:00-17:00\"]\n  isActive             Boolean               @default(true) // Активна ли техкарта для генерации задач\n  autoGenerate         Boolean               @default(true) // Автоматически генерировать задачи\n  \n  object               CleaningObject        @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  room                 Room?                 @relation(fields: [roomId], references: [id], onDelete: Cascade)\n  cleaningObjectItem   CleaningObjectItem?   @relation(fields: [cleaningObjectItemId], references: [id])\n  executions           TaskExecution[]       // Связь с выполнениями\n}\n\nmodel Checklist {\n  id                String         @id @default(cuid())\n  createdAt         DateTime       @default(now())\n  date              DateTime       @db.Date\n  name              String?\n  objectId          String\n  roomId            String?\n  creatorId         String\n  completionComment String?\n  completionPhotos  String[]\n  completedAt       DateTime?\n  completedById     String?\n  completedBy       User?          @relation(\"CompletedChecklists\", fields: [completedById], references: [id])\n  creator           User           @relation(fields: [creatorId], references: [id])\n  object            CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  room              Room?          @relation(fields: [roomId], references: [id])\n  photoReports      PhotoReport[]\n  tasks             Task[]\n}\n\nmodel Task {\n  id                String        @id @default(cuid())\n  createdAt         DateTime      @default(now())\n  description       String\n  status            TaskStatus    @default(NEW)\n  photoUrl          String?\n  objectName        String?\n  roomName          String?\n  scheduledStart    DateTime?\n  scheduledEnd      DateTime?\n  failureReason     String?\n  completionComment String?\n  completionPhotos  String[]\n  checklistId       String?\n  roomId            String?\n  requestId         String?\n  completedById     String?\n  completedAt       DateTime?\n  photoReports      PhotoReport[]\n  checklist         Checklist?    @relation(fields: [checklistId], references: [id], onDelete: Cascade)\n  completedBy       User?         @relation(fields: [completedById], references: [id])\n  request           Request?      @relation(fields: [requestId], references: [id])\n  room              Room?         @relation(fields: [roomId], references: [id])\n  \n  // Новые связи\n  adminComments     TaskAdminComment[]\n  notifications     Notification[]\n}\n\nmodel Request {\n  id           String         @id @default(cuid())\n  createdAt    DateTime       @default(now())\n  updatedAt    DateTime       @updatedAt\n  title        String\n  description  String\n  status       RequestStatus  @default(NEW)\n  source       String?\n  objectId     String\n  creatorId    String\n  photoReports PhotoReport[]\n  creator      User           @relation(fields: [creatorId], references: [id])\n  object       CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  tasks        Task[]\n}\n\nmodel InventoryLimit {\n  id          String         @id @default(cuid())\n  createdAt   DateTime       @default(now())\n  updatedAt   DateTime       @updatedAt\n  amount      Decimal        @db.Decimal(10, 2)\n  month       Int\n  year        Int\n  isRecurring Boolean        @default(false)\n  endDate     DateTime?\n  objectId    String\n  setById     String\n  object      CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  setBy       User           @relation(\"SetInventoryLimits\", fields: [setById], references: [id])\n\n  @@unique([objectId, month, year])\n  @@index([objectId])\n  @@index([month, year])\n}\n\nmodel InventoryExpense {\n  id           String         @id @default(cuid())\n  createdAt    DateTime       @default(now())\n  amount       Decimal        @db.Decimal(10, 2)\n  description  String?\n  month        Int\n  year         Int\n  objectId     String\n  recordedById String\n  object       CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  recordedBy   User           @relation(\"InventoryExpenses\", fields: [recordedById], references: [id])\n\n  @@index([objectId])\n  @@index([month, year])\n}\n\n\nmodel PhotoReport {\n  id          String          @id @default(cuid())\n  createdAt   DateTime        @default(now())\n  url         String\n  comment     String?\n  uploaderId  String\n  objectId    String?\n  checklistId String?\n  requestId   String?\n  taskId      String?\n  checklist   Checklist?      @relation(fields: [checklistId], references: [id])\n  object      CleaningObject? @relation(fields: [objectId], references: [id])\n  request     Request?        @relation(fields: [requestId], references: [id])\n  task        Task?           @relation(fields: [taskId], references: [id])\n  uploader    User            @relation(fields: [uploaderId], references: [id])\n}\n\nmodel AuditLog {\n  id        String   @id @default(cuid())\n  createdAt DateTime @default(now())\n  action    String\n  entity    String\n  entityId  String\n  details   Json?\n  userId    String\n  user      User     @relation(fields: [userId], references: [id])\n}\n\nmodel ClientBinding {\n  id         String         @id @default(cuid())\n  createdAt  DateTime       @default(now())\n  telegramId String\n  objectId   String\n  object     CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n\n  @@unique([telegramId, objectId])\n}\n\nmodel AdditionalTask {\n  id             String               @id @default(cuid())\n  createdAt      DateTime             @default(now())\n  updatedAt      DateTime             @updatedAt\n  title          String\n  content        String\n  source         String\n  sourceDetails  Json\n  attachments    String[]\n  status         AdditionalTaskStatus @default(NEW)\n  objectId       String\n  assignedToId   String\n  takenAt        DateTime?\n  completedAt    DateTime?\n  completedById  String?\n  completionNote String?\n  receivedAt     DateTime\n  assignedTo     User                 @relation(\"AssignedAdditionalTasks\", fields: [assignedToId], references: [id])\n  completedBy    User?                @relation(\"CompletedAdditionalTasks\", fields: [completedById], references: [id])\n  object         CleaningObject       @relation(fields: [objectId], references: [id], onDelete: Cascade)\n}\n\nmodel DeputyAdminAssignment {\n  id            String         @id @default(cuid())\n  createdAt     DateTime       @default(now())\n  deputyAdminId String\n  objectId      String\n  assignedById  String\n  assignedBy    User           @relation(\"AssignedDeputyAdmins\", fields: [assignedById], references: [id])\n  deputyAdmin   User           @relation(\"DeputyAdminAssignments\", fields: [deputyAdminId], references: [id])\n  object        CleaningObject @relation(\"DeputyAdminObjects\", fields: [objectId], references: [id])\n\n  @@unique([deputyAdminId, objectId])\n}\n\nenum Role {\n  ADMIN\n  DEPUTY_ADMIN\n  DEPUTY\n  MANAGER\n  ACCOUNTANT\n  CLIENT\n}\n\nenum TaskStatus {\n  NEW\n  AVAILABLE\n  IN_PROGRESS\n  COMPLETED\n  OVERDUE\n  FAILED\n  CLOSED_WITH_PHOTO\n}\n\nenum RequestStatus {\n  NEW\n  IN_PROGRESS\n  DONE\n  REJECTED\n}\n\nenum AdditionalTaskStatus {\n  NEW\n  IN_PROGRESS\n  COMPLETED\n}\n\n// Плоская таблица для динамического дерева структуры\nmodel ObjectStructure {\n  id                String   @id @default(cuid())\n  createdAt         DateTime @default(now())\n  updatedAt         DateTime @updatedAt\n  \n  // Основные поля\n  objectName        String   // Наименование объекта\n  objectAddress     String?  // Адрес\n  siteName          String?  // Участок\n  zoneName          String?  // Зона\n  roomGroupName     String?  // Группа помещений\n  roomName          String?  // Помещение\n  cleaningObjectName String? // Объект уборки\n  techCardName      String   // Тех задание\n  frequency         String   // Периодичность\n  notes             String?  // Примечания\n  period            String?  // Период (летний/зимний)\n  \n  // Дополнительные поля для связей\n  objectId          String\n  siteId            String?\n  zoneId            String?\n  roomGroupId       String?\n  roomId            String?\n  cleaningObjectId  String?\n  techCardId        String\n  \n  // Поля для UI\n  workType          String?  // Тип работы\n  description       String?  // Описание\n  \n  // Связи\n  object            CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  \n  @@index([objectId])\n  @@index([objectName])\n}\n\n// Задачи отчетности (создаются вручную администраторами)\nmodel ReportingTask {\n  id          String   @id @default(cuid())\n  createdAt   DateTime @default(now())\n  updatedAt   DateTime @updatedAt\n  \n  // Основная информация\n  title       String\n  description String?\n  status      ReportingTaskStatus @default(NEW)\n  priority    ReportingTaskPriority @default(MEDIUM)\n  dueDate     DateTime?\n  completedAt DateTime?\n  \n  // Связи\n  objectId      String\n  object        CleaningObject @relation(\"ReportingTasks\", fields: [objectId], references: [id], onDelete: Cascade)\n  createdById   String\n  createdBy     User @relation(\"CreatedReportingTasks\", fields: [createdById], references: [id])\n  assignedToId  String\n  assignedTo    User @relation(\"AssignedReportingTasks\", fields: [assignedToId], references: [id])\n  \n  // Выполнение\n  completionComment String?\n  \n  // Связи с комментариями и файлами\n  comments    ReportingTaskComment[]\n  attachments ReportingTaskAttachment[]\n  \n  @@index([objectId])\n  @@index([assignedToId])\n  @@index([status])\n}\n\n// Комментарии к задачам отчетности\nmodel ReportingTaskComment {\n  id        String   @id @default(cuid())\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n  \n  content   String\n  \n  // Связи\n  taskId    String\n  task      ReportingTask @relation(fields: [taskId], references: [id], onDelete: Cascade)\n  authorId  String\n  author    User @relation(\"ReportingTaskComments\", fields: [authorId], references: [id])\n  \n  @@index([taskId])\n  @@index([authorId])\n}\n\n// Вложения к задачам отчетности (фотоотчеты и документы)\nmodel ReportingTaskAttachment {\n  id        String   @id @default(cuid())\n  createdAt DateTime @default(now())\n  \n  fileName     String\n  originalName String\n  fileSize     Int\n  mimeType     String\n  filePath     String\n  \n  // Связи\n  taskId       String\n  task         ReportingTask @relation(fields: [taskId], references: [id], onDelete: Cascade)\n  uploadedById String\n  uploadedBy   User @relation(\"ReportingTaskAttachments\", fields: [uploadedById], references: [id])\n  \n  @@index([taskId])\n  @@index([uploadedById])\n}\n\n// Таблица для исключенных объектов (восстанавливаем)\nmodel ExcludedObject {\n  id          String   @id @default(cuid())\n  objectId    String   @unique\n  excludedAt  DateTime @default(now())\n  excludedById String\n  \n  object      CleaningObject @relation(\"ExcludedObjects\", fields: [objectId], references: [id], onDelete: Cascade)\n  excludedBy  User @relation(\"ExcludedObjects\", fields: [excludedById], references: [id])\n}\n\nenum ReportingTaskStatus {\n  NEW\n  IN_PROGRESS\n  COMPLETED\n  CANCELLED\n}\n\nenum ReportingTaskPriority {\n  LOW\n  MEDIUM\n  HIGH\n  URGENT\n}\n\n// Новая модель для календаря задач\nmodel TaskExecution {\n  id          String   @id @default(cuid())\n  \n  // Связи\n  techCardId  String\n  techCard    TechCard @relation(fields: [techCardId], references: [id], onDelete: Cascade)\n  objectId    String\n  object      CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  managerId   String\n  manager     User @relation(\"TaskExecutions\", fields: [managerId], references: [id])\n  \n  // Планирование\n  scheduledFor DateTime  // Когда должно было быть выполнено\n  dueDate      DateTime  // Крайний срок выполнения\n  \n  // Выполнение\n  executedAt   DateTime? // Когда фактически выполнено\n  status       TaskExecutionStatus @default(PENDING)\n  \n  // Отчетность\n  comment      String?   // Комментарий менеджера\n  photos       String[]  // Массив URL фотографий\n  \n  // Метаданные\n  createdAt    DateTime @default(now())\n  updatedAt    DateTime @updatedAt\n  \n  @@index([managerId, scheduledFor])\n  @@index([objectId, scheduledFor])\n  @@index([status, scheduledFor])\n  @@index([techCardId, scheduledFor])\n}\n\nenum TaskExecutionStatus {\n  PENDING     // Ожидает выполнения\n  COMPLETED   // Выполнено\n  OVERDUE     // Просрочено\n  SKIPPED     // Пропущено (с комментарием)\n}\n\n// Комментарии администраторов к задачам\nmodel TaskAdminComment {\n  id        String   @id @default(cuid())\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n\n  // Содержимое комментария\n  content String @db.Text\n  type    TaskAdminCommentType\n\n  // Связи\n  taskId  String\n  task    Task   @relation(fields: [taskId], references: [id], onDelete: Cascade)\n  \n  adminId String\n  admin   User   @relation(\"AdminComments\", fields: [adminId], references: [id], onDelete: Cascade)\n\n  // Для ответов на комментарии (threading)\n  parentCommentId String?\n  parentComment   TaskAdminComment? @relation(\"CommentReplies\", fields: [parentCommentId], references: [id])\n  replies         TaskAdminComment[] @relation(\"CommentReplies\")\n\n  @@map(\"task_admin_comments\")\n}\n\n// Типы комментариев администраторов\nenum TaskAdminCommentType {\n  ADMIN_NOTE          // Заметка администратора\n  COMPLETION_FEEDBACK // Отзыв о выполнении\n  INSTRUCTION         // Указание/инструкция\n  QUALITY_CHECK       // Проверка качества\n}\n\n// Уведомления для менеджеров\nmodel Notification {\n  id        String   @id @default(cuid())\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n\n  // Получатель уведомления\n  userId String\n  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)\n\n  // Содержимое уведомления\n  type    String\n  title   String\n  message String @db.Text\n  isRead  Boolean @default(false)\n\n  // Связанные объекты (опционально)\n  relatedTaskId String?\n  relatedTask   Task?   @relation(fields: [relatedTaskId], references: [id], onDelete: SetNull)\n\n  @@map(\"notifications\")\n}\n",
  "models": [
    {
      "name": "User",
      "content": "model User {\n  id                       String                  @id @default(cuid())\n  createdAt                DateTime                @default(now())\n  updatedAt                DateTime                @updatedAt\n  email                    String                  @unique\n  name                     String?\n  phone                    String?\n  password                 String\n  role                     Role                    @default(MANAGER)\n  assignedAdditionalTasks  AdditionalTask[]        @relation(\"AssignedAdditionalTasks\")\n  completedAdditionalTasks AdditionalTask[]        @relation(\"CompletedAdditionalTasks\")\n  auditLogs                AuditLog[]\n  completedChecklists      Checklist[]             @relation(\"CompletedChecklists\")\n  createdChecklists        Checklist[]\n  createdObjects           CleaningObject[]        @relation(\"CreatedBy\")\n  managedObjects           CleaningObject[]        @relation(\"ManagedBy\")\n  assignedDeputyAdmins     DeputyAdminAssignment[] @relation(\"AssignedDeputyAdmins\")\n  deputyAdminAssignments   DeputyAdminAssignment[] @relation(\"DeputyAdminAssignments\")\n  inventoryExpenses        InventoryExpense[]      @relation(\"InventoryExpenses\")\n  setInventoryLimits       InventoryLimit[]        @relation(\"SetInventoryLimits\")\n  photoReports             PhotoReport[]\n  createdRequests          Request[]\n  completedTasks           Task[]\n  managedSites             Site[]                  @relation(\"SiteManager\")\n  taskExecutions           TaskExecution[]         @relation(\"TaskExecutions\")\n  createdReportingTasks    ReportingTask[]         @relation(\"CreatedReportingTasks\")\n  assignedReportingTasks   ReportingTask[]         @relation(\"AssignedReportingTasks\")\n  excludedObjects          ExcludedObject[]        @relation(\"ExcludedObjects\")\n  \n  // Новые связи для комментариев и уведомлений\n  adminComments            TaskAdminComment[]      @relation(\"AdminComments\")\n  notifications            Notification[]\n  \n  // Связи для задач отчетности\n  reportingTaskComments    ReportingTaskComment[]  @relation(\"ReportingTaskComments\")\n  reportingTaskAttachments ReportingTaskAttachment[] @relation(\"ReportingTaskAttachments\")\n}"
    },
    {
      "name": "CleaningObject",
      "content": "model CleaningObject {\n  id                          String                  @id @default(cuid())\n  createdAt                   DateTime                @default(now())\n  updatedAt                   DateTime                @updatedAt\n  name                        String\n  address                     String\n  documents                   Json?\n  timezone                    String?\n  workingHours                Json?\n  workingDays                 String[]\n  autoChecklistEnabled        Boolean                 @default(true)\n  lastChecklistDate           DateTime?\n  requirePhotoForCompletion   Boolean                 @default(false)\n  requireCommentForCompletion Boolean                 @default(false)\n  completionRequirements      Json?\n  creatorId                   String\n  managerId                   String?\n  \n  // Новые поля для многоуровневой структуры\n  totalArea                   Float?                  // Общая площадь объекта\n  description                 String?                 // Описание объекта\n  notes                       String?                 // Примечания к объекту\n  \n  additionalTasks             AdditionalTask[]\n  checklists                  Checklist[]\n  creator                     User                    @relation(\"CreatedBy\", fields: [creatorId], references: [id])\n  manager                     User?                   @relation(\"ManagedBy\", fields: [managerId], references: [id])\n  clientBindings              ClientBinding[]\n  deputyAdminAssignments      DeputyAdminAssignment[] @relation(\"DeputyAdminObjects\")\n  inventoryExpenses           InventoryExpense[]\n  inventoryLimits             InventoryLimit[]\n  photoReports                PhotoReport[]\n  requests                    Request[]\n  rooms                       Room[]\n  techCards                   TechCard[]\n  sites                       Site[]                  // Участки объекта\n  objectStructures            ObjectStructure[]       // Плоская структура\n  taskExecutions              TaskExecution[]         // Выполнения задач\n  reportingTasks              ReportingTask[]         @relation(\"ReportingTasks\") // Задачи отчетности для объекта\n  excludedObjects             ExcludedObject[]        @relation(\"ExcludedObjects\") // Исключения из отчетности\n}"
    },
    {
      "name": "Room",
      "content": "model Room {\n  id              String               @id @default(cuid())\n  createdAt       DateTime             @default(now())\n  name            String\n  description     String?\n  area            Float?\n  objectId        String\n  roomGroupId     String?              // Связь с группой помещений\n  \n  checklists      Checklist[]\n  object          CleaningObject       @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  roomGroup       RoomGroup?           @relation(fields: [roomGroupId], references: [id])\n  tasks           Task[]\n  techCards       TechCard[]\n  cleaningObjects CleaningObjectItem[] // Объекты уборки в помещении\n}"
    },
    {
      "name": "Site",
      "content": "model Site {\n  id          String         @id @default(cuid())\n  createdAt   DateTime       @default(now())\n  name        String         // Название участка\n  description String?        // Описание участка\n  area        Float?         // Площадь участка\n  comment     String?        // Комментарий к участку (переименовано из areaInfo)\n  objectId    String\n  managerId   String?        // Менеджер участка\n  \n  object      CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  manager     User?          @relation(\"SiteManager\", fields: [managerId], references: [id])\n  zones       Zone[]         // Зоны участка\n}"
    },
    {
      "name": "Zone",
      "content": "model Zone {\n  id          String      @id @default(cuid())\n  createdAt   DateTime    @default(now())\n  name        String      // Название зоны\n  description String?     // Описание зоны\n  area        Float?      // Площадь зоны\n  siteId      String\n  \n  site        Site        @relation(fields: [siteId], references: [id], onDelete: Cascade)\n  roomGroups  RoomGroup[] // Группы помещений\n}"
    },
    {
      "name": "RoomGroup",
      "content": "model RoomGroup {\n  id          String   @id @default(cuid())\n  createdAt   DateTime @default(now())\n  name        String   // Название группы помещений\n  description String?  // Описание группы\n  area        Float?   // Площадь группы\n  zoneId      String\n  \n  zone        Zone     @relation(fields: [zoneId], references: [id], onDelete: Cascade)\n  rooms       Room[]   // Помещения в группе\n}"
    },
    {
      "name": "CleaningObjectItem",
      "content": "model CleaningObjectItem {\n  id          String     @id @default(cuid())\n  createdAt   DateTime   @default(now())\n  name        String     // Название объекта уборки (пол, стены, окна и т.д.)\n  description String?    // Описание объекта уборки\n  roomId      String\n  \n  room        Room       @relation(fields: [roomId], references: [id], onDelete: Cascade)\n  techCards   TechCard[] // Техкарты для этого объекта уборки\n}"
    },
    {
      "name": "TechCard",
      "content": "model TechCard {\n  id                   String                @id @default(cuid())\n  createdAt            DateTime              @default(now())\n  name                 String\n  workType             String\n  frequency            String\n  description          String?\n  objectId             String\n  \n  // Привязка к элементам структуры (иерархическая)\n  siteId               String?               // Участок\n  zoneId               String?               // Зона\n  roomGroupId          String?               // Группа помещений\n  roomId               String?               // Помещение\n  cleaningObjectItemId String?               // Объект уборки\n  \n  // Новые поля для детализации\n  period               String?               // Период (летний/зимний)\n  seasonality          String?               // Сезонность (Общий, Зимний период, Летний период)\n  notes                String?               // Примечания\n  workDetails          String?               // Детальное описание работ\n  \n  // Новые поля для календаря задач\n  frequencyDays        Int?                  // Периодичность в днях (1=ежедневно, 7=еженедельно, 30=ежемесячно)\n  preferredTime        String?               // Предпочтительное время выполнения \"09:00\"\n  maxDelayHours        Int?                  // Максимальная задержка в часах\n  timeSlots            String[]              // Временные промежутки в течение дня [\"09:00-12:00\", \"14:00-17:00\"]\n  isActive             Boolean               @default(true) // Активна ли техкарта для генерации задач\n  autoGenerate         Boolean               @default(true) // Автоматически генерировать задачи\n  \n  object               CleaningObject        @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  room                 Room?                 @relation(fields: [roomId], references: [id], onDelete: Cascade)\n  cleaningObjectItem   CleaningObjectItem?   @relation(fields: [cleaningObjectItemId], references: [id])\n  executions           TaskExecution[]       // Связь с выполнениями\n}"
    },
    {
      "name": "Checklist",
      "content": "model Checklist {\n  id                String         @id @default(cuid())\n  createdAt         DateTime       @default(now())\n  date              DateTime       @db.Date\n  name              String?\n  objectId          String\n  roomId            String?\n  creatorId         String\n  completionComment String?\n  completionPhotos  String[]\n  completedAt       DateTime?\n  completedById     String?\n  completedBy       User?          @relation(\"CompletedChecklists\", fields: [completedById], references: [id])\n  creator           User           @relation(fields: [creatorId], references: [id])\n  object            CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  room              Room?          @relation(fields: [roomId], references: [id])\n  photoReports      PhotoReport[]\n  tasks             Task[]\n}"
    },
    {
      "name": "Task",
      "content": "model Task {\n  id                String        @id @default(cuid())\n  createdAt         DateTime      @default(now())\n  description       String\n  status            TaskStatus    @default(NEW)\n  photoUrl          String?\n  objectName        String?\n  roomName          String?\n  scheduledStart    DateTime?\n  scheduledEnd      DateTime?\n  failureReason     String?\n  completionComment String?\n  completionPhotos  String[]\n  checklistId       String?\n  roomId            String?\n  requestId         String?\n  completedById     String?\n  completedAt       DateTime?\n  photoReports      PhotoReport[]\n  checklist         Checklist?    @relation(fields: [checklistId], references: [id], onDelete: Cascade)\n  completedBy       User?         @relation(fields: [completedById], references: [id])\n  request           Request?      @relation(fields: [requestId], references: [id])\n  room              Room?         @relation(fields: [roomId], references: [id])\n  \n  // Новые связи\n  adminComments     TaskAdminComment[]\n  notifications     Notification[]\n}"
    },
    {
      "name": "Request",
      "content": "model Request {\n  id           String         @id @default(cuid())\n  createdAt    DateTime       @default(now())\n  updatedAt    DateTime       @updatedAt\n  title        String\n  description  String\n  status       RequestStatus  @default(NEW)\n  source       String?\n  objectId     String\n  creatorId    String\n  photoReports PhotoReport[]\n  creator      User           @relation(fields: [creatorId], references: [id])\n  object       CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  tasks        Task[]\n}"
    },
    {
      "name": "InventoryLimit",
      "content": "model InventoryLimit {\n  id          String         @id @default(cuid())\n  createdAt   DateTime       @default(now())\n  updatedAt   DateTime       @updatedAt\n  amount      Decimal        @db.Decimal(10, 2)\n  month       Int\n  year        Int\n  isRecurring Boolean        @default(false)\n  endDate     DateTime?\n  objectId    String\n  setById     String\n  object      CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  setBy       User           @relation(\"SetInventoryLimits\", fields: [setById], references: [id])\n\n  @@unique([objectId, month, year])\n  @@index([objectId])\n  @@index([month, year])\n}"
    },
    {
      "name": "InventoryExpense",
      "content": "model InventoryExpense {\n  id           String         @id @default(cuid())\n  createdAt    DateTime       @default(now())\n  amount       Decimal        @db.Decimal(10, 2)\n  description  String?\n  month        Int\n  year         Int\n  objectId     String\n  recordedById String\n  object       CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  recordedBy   User           @relation(\"InventoryExpenses\", fields: [recordedById], references: [id])\n\n  @@index([objectId])\n  @@index([month, year])\n}"
    },
    {
      "name": "PhotoReport",
      "content": "model PhotoReport {\n  id          String          @id @default(cuid())\n  createdAt   DateTime        @default(now())\n  url         String\n  comment     String?\n  uploaderId  String\n  objectId    String?\n  checklistId String?\n  requestId   String?\n  taskId      String?\n  checklist   Checklist?      @relation(fields: [checklistId], references: [id])\n  object      CleaningObject? @relation(fields: [objectId], references: [id])\n  request     Request?        @relation(fields: [requestId], references: [id])\n  task        Task?           @relation(fields: [taskId], references: [id])\n  uploader    User            @relation(fields: [uploaderId], references: [id])\n}"
    },
    {
      "name": "AuditLog",
      "content": "model AuditLog {\n  id        String   @id @default(cuid())\n  createdAt DateTime @default(now())\n  action    String\n  entity    String\n  entityId  String\n  details   Json?\n  userId    String\n  user      User     @relation(fields: [userId], references: [id])\n}"
    },
    {
      "name": "ClientBinding",
      "content": "model ClientBinding {\n  id         String         @id @default(cuid())\n  createdAt  DateTime       @default(now())\n  telegramId String\n  objectId   String\n  object     CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n\n  @@unique([telegramId, objectId])\n}"
    },
    {
      "name": "AdditionalTask",
      "content": "model AdditionalTask {\n  id             String               @id @default(cuid())\n  createdAt      DateTime             @default(now())\n  updatedAt      DateTime             @updatedAt\n  title          String\n  content        String\n  source         String\n  sourceDetails  Json\n  attachments    String[]\n  status         AdditionalTaskStatus @default(NEW)\n  objectId       String\n  assignedToId   String\n  takenAt        DateTime?\n  completedAt    DateTime?\n  completedById  String?\n  completionNote String?\n  receivedAt     DateTime\n  assignedTo     User                 @relation(\"AssignedAdditionalTasks\", fields: [assignedToId], references: [id])\n  completedBy    User?                @relation(\"CompletedAdditionalTasks\", fields: [completedById], references: [id])\n  object         CleaningObject       @relation(fields: [objectId], references: [id], onDelete: Cascade)\n}"
    },
    {
      "name": "DeputyAdminAssignment",
      "content": "model DeputyAdminAssignment {\n  id            String         @id @default(cuid())\n  createdAt     DateTime       @default(now())\n  deputyAdminId String\n  objectId      String\n  assignedById  String\n  assignedBy    User           @relation(\"AssignedDeputyAdmins\", fields: [assignedById], references: [id])\n  deputyAdmin   User           @relation(\"DeputyAdminAssignments\", fields: [deputyAdminId], references: [id])\n  object        CleaningObject @relation(\"DeputyAdminObjects\", fields: [objectId], references: [id])\n\n  @@unique([deputyAdminId, objectId])\n}"
    },
    {
      "name": "ObjectStructure",
      "content": "model ObjectStructure {\n  id                String   @id @default(cuid())\n  createdAt         DateTime @default(now())\n  updatedAt         DateTime @updatedAt\n  \n  // Основные поля\n  objectName        String   // Наименование объекта\n  objectAddress     String?  // Адрес\n  siteName          String?  // Участок\n  zoneName          String?  // Зона\n  roomGroupName     String?  // Группа помещений\n  roomName          String?  // Помещение\n  cleaningObjectName String? // Объект уборки\n  techCardName      String   // Тех задание\n  frequency         String   // Периодичность\n  notes             String?  // Примечания\n  period            String?  // Период (летний/зимний)\n  \n  // Дополнительные поля для связей\n  objectId          String\n  siteId            String?\n  zoneId            String?\n  roomGroupId       String?\n  roomId            String?\n  cleaningObjectId  String?\n  techCardId        String\n  \n  // Поля для UI\n  workType          String?  // Тип работы\n  description       String?  // Описание\n  \n  // Связи\n  object            CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  \n  @@index([objectId])\n  @@index([objectName])\n}"
    },
    {
      "name": "ReportingTask",
      "content": "model ReportingTask {\n  id          String   @id @default(cuid())\n  createdAt   DateTime @default(now())\n  updatedAt   DateTime @updatedAt\n  \n  // Основная информация\n  title       String\n  description String?\n  status      ReportingTaskStatus @default(NEW)\n  priority    ReportingTaskPriority @default(MEDIUM)\n  dueDate     DateTime?\n  completedAt DateTime?\n  \n  // Связи\n  objectId      String\n  object        CleaningObject @relation(\"ReportingTasks\", fields: [objectId], references: [id], onDelete: Cascade)\n  createdById   String\n  createdBy     User @relation(\"CreatedReportingTasks\", fields: [createdById], references: [id])\n  assignedToId  String\n  assignedTo    User @relation(\"AssignedReportingTasks\", fields: [assignedToId], references: [id])\n  \n  // Выполнение\n  completionComment String?\n  \n  // Связи с комментариями и файлами\n  comments    ReportingTaskComment[]\n  attachments ReportingTaskAttachment[]\n  \n  @@index([objectId])\n  @@index([assignedToId])\n  @@index([status])\n}"
    },
    {
      "name": "ReportingTaskComment",
      "content": "model ReportingTaskComment {\n  id        String   @id @default(cuid())\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n  \n  content   String\n  \n  // Связи\n  taskId    String\n  task      ReportingTask @relation(fields: [taskId], references: [id], onDelete: Cascade)\n  authorId  String\n  author    User @relation(\"ReportingTaskComments\", fields: [authorId], references: [id])\n  \n  @@index([taskId])\n  @@index([authorId])\n}"
    },
    {
      "name": "ReportingTaskAttachment",
      "content": "model ReportingTaskAttachment {\n  id        String   @id @default(cuid())\n  createdAt DateTime @default(now())\n  \n  fileName     String\n  originalName String\n  fileSize     Int\n  mimeType     String\n  filePath     String\n  \n  // Связи\n  taskId       String\n  task         ReportingTask @relation(fields: [taskId], references: [id], onDelete: Cascade)\n  uploadedById String\n  uploadedBy   User @relation(\"ReportingTaskAttachments\", fields: [uploadedById], references: [id])\n  \n  @@index([taskId])\n  @@index([uploadedById])\n}"
    },
    {
      "name": "ExcludedObject",
      "content": "model ExcludedObject {\n  id          String   @id @default(cuid())\n  objectId    String   @unique\n  excludedAt  DateTime @default(now())\n  excludedById String\n  \n  object      CleaningObject @relation(\"ExcludedObjects\", fields: [objectId], references: [id], onDelete: Cascade)\n  excludedBy  User @relation(\"ExcludedObjects\", fields: [excludedById], references: [id])\n}"
    },
    {
      "name": "TaskExecution",
      "content": "model TaskExecution {\n  id          String   @id @default(cuid())\n  \n  // Связи\n  techCardId  String\n  techCard    TechCard @relation(fields: [techCardId], references: [id], onDelete: Cascade)\n  objectId    String\n  object      CleaningObject @relation(fields: [objectId], references: [id], onDelete: Cascade)\n  managerId   String\n  manager     User @relation(\"TaskExecutions\", fields: [managerId], references: [id])\n  \n  // Планирование\n  scheduledFor DateTime  // Когда должно было быть выполнено\n  dueDate      DateTime  // Крайний срок выполнения\n  \n  // Выполнение\n  executedAt   DateTime? // Когда фактически выполнено\n  status       TaskExecutionStatus @default(PENDING)\n  \n  // Отчетность\n  comment      String?   // Комментарий менеджера\n  photos       String[]  // Массив URL фотографий\n  \n  // Метаданные\n  createdAt    DateTime @default(now())\n  updatedAt    DateTime @updatedAt\n  \n  @@index([managerId, scheduledFor])\n  @@index([objectId, scheduledFor])\n  @@index([status, scheduledFor])\n  @@index([techCardId, scheduledFor])\n}"
    },
    {
      "name": "TaskAdminComment",
      "content": "model TaskAdminComment {\n  id        String   @id @default(cuid())\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n\n  // Содержимое комментария\n  content String @db.Text\n  type    TaskAdminCommentType\n\n  // Связи\n  taskId  String\n  task    Task   @relation(fields: [taskId], references: [id], onDelete: Cascade)\n  \n  adminId String\n  admin   User   @relation(\"AdminComments\", fields: [adminId], references: [id], onDelete: Cascade)\n\n  // Для ответов на комментарии (threading)\n  parentCommentId String?\n  parentComment   TaskAdminComment? @relation(\"CommentReplies\", fields: [parentCommentId], references: [id])\n  replies         TaskAdminComment[] @relation(\"CommentReplies\")\n\n  @@map(\"task_admin_comments\")\n}"
    },
    {
      "name": "Notification",
      "content": "model Notification {\n  id        String   @id @default(cuid())\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n\n  // Получатель уведомления\n  userId String\n  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)\n\n  // Содержимое уведомления\n  type    String\n  title   String\n  message String @db.Text\n  isRead  Boolean @default(false)\n\n  // Связанные объекты (опционально)\n  relatedTaskId String?\n  relatedTask   Task?   @relation(fields: [relatedTaskId], references: [id], onDelete: SetNull)\n\n  @@map(\"notifications\")\n}"
    }
  ]
}