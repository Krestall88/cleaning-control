# ‚úÖ –û–¢–ß–ï–¢: –°–ë–†–û–° –ü–†–û–°–†–û–ß–ï–ù–ù–´–• –ó–ê–î–ê–ß –ò–°–ü–†–ê–í–õ–ï–ù

**–î–∞—Ç–∞:** 29 –æ–∫—Ç—è–±—Ä—è 2025, 11:00 UTC+3  
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û - –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Ç–µ–ø–µ—Ä—å –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è

## üîç –ü–†–û–ë–õ–ï–ú–ê –ò –†–ï–®–ï–ù–ò–ï

### **–ü—Ä–æ–±–ª–µ–º–∞:**
- –°–±—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –≤ –ë–î (–∑–∞–¥–∞—á–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ FAILED)
- –ù–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—å –≤—Å–µ –µ—â–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –ü—Ä–∏—á–∏–Ω–∞: —Ñ—É–Ω–∫—Ü–∏—è `calculateTaskStatus` –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∞ —Å—Ç–∞—Ç—É—Å –∏–∑ –ë–î

### **–†–µ—à–µ–Ω–∏–µ:**
1. **–ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `calculateTaskStatus`** - —É–±—Ä–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–º–µ—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á –∫–∞–∫ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö
2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `getActualOverdueTasks`** - –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏–∑ –ë–î
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ `groupTasksByStatus`** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
4. **–û–±–Ω–æ–≤–ª–µ–Ω API –∫–∞–ª–µ–Ω–¥–∞—Ä—è** - —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### **1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è calculateTaskStatus**
```typescript
// –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
export function calculateTaskStatus(scheduledDate: Date) {
  if (taskDate < today) {
    return 'OVERDUE'; // –í—Å–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏ = –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ
  }
}

// –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
export function calculateTaskStatus(scheduledDate: Date) {
  if (taskDate < today) {
    return 'PENDING'; // –ù–µ –ø–æ–º–µ—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∫ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ
  }
}
```

### **2. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è getActualOverdueTasks**
```typescript
export async function getActualOverdueTasks(baseDate, userRole, userId, objectId) {
  // –ò—â–µ–º –≤ –ë–î –∑–∞–¥–∞—á–∏ —Å:
  // - scheduledStart < today (–¥–∞—Ç–∞ –≤ –ø—Ä–æ—à–ª–æ–º)
  // - status NOT IN ('COMPLETED', 'CLOSED_WITH_PHOTO', 'FAILED')
  // - —É—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
  const overdueTasks = await prisma.task.findMany({
    where: {
      scheduledStart: { lt: today },
      status: { notIn: ['COMPLETED', 'CLOSED_WITH_PHOTO', 'FAILED'] }
    }
  });
  
  return overdueTasks; // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ UnifiedTask —Ñ–æ—Ä–º–∞—Ç
}
```

### **3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è groupTasksByStatus**
```typescript
// –ë–´–õ–û:
export function groupTasksByStatus(tasks, baseDate) {
  return {
    overdue: tasks.filter(task => task.status === 'OVERDUE') // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
  };
}

// –°–¢–ê–õ–û:
export function groupTasksByStatus(tasks, baseDate, overdueTasks = []) {
  return {
    overdue: overdueTasks // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
  };
}
```

### **4. –û–±–Ω–æ–≤–ª–µ–Ω API –∫–∞–ª–µ–Ω–¥–∞—Ä—è**
```typescript
// –í /api/tasks/calendar-unified/route.ts:
const actualOverdueTasks = await getActualOverdueTasks(
  baseDate, user.role, user.id, objectId
);

const statusGroups = groupTasksByStatus(allTasks, baseDate, actualOverdueTasks);
```

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### **–¢–µ–ø–µ—Ä—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ:**
- ‚úÖ **–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ**: 0 (–∑–∞–¥–∞—á–∏ –æ—Ç 27.10 –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ FAILED –∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è)
- ‚úÖ **–¢–µ–∫—É—â–∏–µ**: —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (29.10)
- ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ**: —Ç–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Å–µ–≥–æ–¥–Ω—è
- ‚úÖ **–ù–æ–≤–∞—è —Ç–æ—á–∫–∞ –æ—Ç—Å—á–µ—Ç–∞**: —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è

### **–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
- üìÖ **–°–µ–≥–æ–¥–Ω—è (29.10)**: –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö = 0, —Ç–µ–∫—É—â–∏–µ = –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
- üìÖ **–ó–∞–≤—Ç—Ä–∞ (30.10)**: –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ = –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Å 29.10 (–µ—Å–ª–∏ –Ω–µ –∑–∞–∫—Ä–æ–µ—à—å)
- üìÖ **–í—á–µ—Ä–∞ (28.10)**: –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ = —Ç–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ 28.10

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### **–°–µ—Ä–≤–µ—Ä:**
- üåê **URL**: http://localhost:3001
- ‚úÖ **–°—Ç–∞—Ç—É—Å**: –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π
- ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ FAILED

### **–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ:**
1. `calculateTaskStatus()` - –Ω–µ –ø–æ–º–µ—á–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏ –∫–∞–∫ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ
2. `getActualOverdueTasks()` - –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö
3. `groupTasksByStatus()` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä
4. API –∫–∞–ª–µ–Ω–¥–∞—Ä—è - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ **–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã** - –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª–µ–Ω–æ
- ‚úÖ **–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω** - –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ FAILED
- ‚úÖ **–û—Ç–∫–∞—Ç –≤–æ–∑–º–æ–∂–µ–Ω** - –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞—Ç–Ω–æ

## üß™ –ü–†–û–í–ï–†–ö–ê

### **–ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. **–ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è** - –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 ‚úÖ
2. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤** - –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ ‚úÖ
3. **–í—ã–¥–µ–ª–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö** - –∫—Ä–∞—Å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å ‚úÖ
4. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–Ω–µ–π** - —Å—á–µ—Ç—á–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è ‚úÖ

### **–ó–∞–≤—Ç—Ä–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. **–ü–æ—è–≤–∏–ª–∏—Å—å –ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ** - –µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è —á—Ç–æ-—Ç–æ –Ω–µ –∑–∞–∫—Ä—ã–ª–∏
2. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è** - —Ç–æ–ª—å–∫–æ –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

## üìä –ò–¢–û–ì–ò

### **–ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê:**
- ‚ùå **–°–±—Ä–æ—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–ª** ‚Üí ‚úÖ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏—Å—á–µ–∑–ª–∏
- ‚ùå **–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–ª —Å—Ç–∞—Ä—ã–µ** ‚Üí ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ
- ‚ùå **–õ–æ–≥–∏–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∞ –ë–î** ‚Üí ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∏–∑ –ë–î

### **–°–ò–°–¢–ï–ú–ê –†–ê–ë–û–¢–ê–ï–¢:**
- üéØ **–¢–æ—á–∫–∞ –æ—Ç—Å—á–µ—Ç–∞** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
- üìä **–°—á–µ—Ç—á–∏–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ** - –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ –¥–Ω—è–º
- üîÑ **–õ–æ–≥–∏–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–∫–∏** - —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á

---

**–°–ë–†–û–° –ü–†–û–°–†–û–ß–ï–ù–ù–´–• –ó–ê–î–ê–ß –†–ê–ë–û–¢–ê–ï–¢!** ‚úÖ

–¢–µ–ø–µ—Ä—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –°–µ–≥–æ–¥–Ω—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–µ—Ç
- –ó–∞–≤—Ç—Ä–∞ –ø–æ—è–≤—è—Ç—Å—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ, –µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –Ω–µ –∑–∞–∫—Ä–æ–µ—à—å
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤–æ–π —Ç–æ—á–∫–∏ –æ—Ç—Å—á–µ—Ç–∞
