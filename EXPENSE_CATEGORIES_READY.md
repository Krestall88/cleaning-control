# ✅ Система статей расходов - ГОТОВА К ПРИМЕНЕНИЮ

## 🎉 Что реализовано

### ✅ Модальное окно "Лимит"
- Выбор категории из списка
- Для админа: кнопка "+ Создать новую категорию"
- Inline форма создания категории
- Ввод суммы лимита
- Настройка повторяющихся лимитов
- Сохранение лимита с привязкой к категории

### ✅ Модальное окно "Расход"
- Выбор категории из списка (опционально)
- Опция "Без категории"
- Ввод суммы и описания
- Автоматическая проверка лимитов
- Предупреждения при превышении лимита

### ✅ Модальное окно "Подробно"
- **2 вкладки:**
  - **"Общее"** - текущая аналитика (график, общие цифры)
  - **"По статьям"** - детальная разбивка по категориям
- Карточки по каждой категории
- Прогресс-бары использования лимитов
- Предупреждения о превышении

### ✅ Backend API
- 8 endpoints для управления категориями и лимитами
- Автоматическая проверка лимитов при добавлении расхода
- Статистика по категориям
- Seed-скрипт для 10 предустановленных категорий

## 🚀 Применение (4 команды)

### Шаг 1: Применить миграцию БД
```bash
cd c:\Users\Тайм\Documents\toplevel
npx prisma migrate deploy
```

### Шаг 2: Сгенерировать Prisma Client
```bash
npx prisma generate
```

### Шаг 3: Создать начальные категории
```bash
npx ts-node prisma/seeds/expense-categories.ts
```

### Шаг 4: Перезапустить dev server
```bash
npm run dev
```

## 📋 Как использовать

### Для администратора:

#### 1. Создание лимита с категорией:
1. Открыть `/inventory`
2. Найти нужный объект
3. Нажать кнопку **"Лимит"**
4. Выбрать категорию из списка
5. Если нужной категории нет - нажать **"+ Создать новую категорию"**
6. Ввести название и описание новой категории
7. Нажать **"Создать"** - категория автоматически выберется
8. Ввести сумму лимита
9. Настроить повторяющийся лимит (опционально)
10. Нажать **"Сохранить"**

#### 2. Добавление расхода с категорией:
1. Открыть `/inventory`
2. Найти нужный объект
3. Нажать кнопку **"Расход"**
4. Выбрать категорию (или оставить "Без категории")
5. Ввести сумму и описание
6. Нажать **"Добавить"**
7. Система автоматически проверит лимиты:
   - Если лимит превышен → ошибка
   - Если использовано >90% → предупреждение
   - Иначе → успешно добавлено

#### 3. Просмотр статистики по категориям:
1. Открыть `/inventory`
2. Найти нужный объект
3. Нажать кнопку **"Подробно"**
4. Переключиться на вкладку **"По статьям"**
5. Увидеть:
   - Общую статистику (потрачено/лимит/остаток)
   - Карточки по каждой категории
   - Прогресс-бары использования
   - Предупреждения о превышении

### Для менеджера:

#### Добавление расхода:
1. Открыть `/inventory`
2. Видит только свои объекты
3. Нажать **"Расход"**
4. Выбрать категорию (опционально)
5. Ввести сумму и описание
6. Система автоматически проверит лимиты
7. Получить предупреждение или ошибку при превышении

#### Просмотр статистики:
1. Нажать **"Подробно"**
2. Переключиться на вкладку **"По статьям"**
3. Увидеть детальную разбивку по категориям

## 📊 Предустановленные категории (10 шт)

1. **Химия, инвентарь, расходники** - моющие средства, инвентарь
2. **Тележки** - уборочные тележки
3. **Спецодежда** - рабочая одежда, СИЗ
4. **Покупка оборудования** - закупка нового оборудования
5. **Ремонт оборудования** - ремонт и обслуживание
6. **Медицинские книжки** - оформление медкнижек
7. **ГСМ** - горюче-смазочные материалы
8. **Вызов техники в зимний период** - снегоуборочная техника
9. **Реагенты** - противогололедные реагенты
10. **Диспенсеры** - диспенсеры для расходников

## 🎯 Примеры использования

### Пример 1: Создание лимита на химию

**Действия:**
1. Открыть `/inventory`
2. Найти "Офис А"
3. Нажать "Лимит"
4. Выбрать "Химия, инвентарь, расходники"
5. Ввести сумму: 30000
6. Месяц: Ноябрь, Год: 2025
7. Поставить галочку "Повторять каждый месяц"
8. Нажать "Сохранить"

**Результат:**
- Лимит 30000₽ установлен на ноябрь 2025
- Будет автоматически повторяться каждый месяц

### Пример 2: Добавление расхода на химию

**Действия:**
1. Открыть `/inventory`
2. Найти "Офис А"
3. Нажать "Расход"
4. Выбрать "Химия, инвентарь, расходники"
5. Ввести сумму: 5000
6. Описание: "Моющее средство"
7. Нажать "Добавить"

**Результат:**
- Расход добавлен
- Система проверила лимит
- Если потрачено >27000₽ (90%) → показано предупреждение
- Если потрачено >30000₽ → ошибка, расход не добавлен

### Пример 3: Создание новой категории на лету

**Действия (только для админа):**
1. Открыть `/inventory`
2. Найти любой объект
3. Нажать "Лимит"
4. Нажать "+ Создать новую категорию"
5. Название: "Офисные принадлежности"
6. Описание: "Бумага, ручки, папки"
7. Нажать "Создать"
8. Категория автоматически выбрана
9. Ввести сумму лимита
10. Нажать "Сохранить"

**Результат:**
- Новая категория создана
- Лимит установлен на эту категорию
- Категория доступна для всех объектов

## 🔐 Права доступа

### Администратор:
- ✅ Создание категорий (в модальном окне лимита)
- ✅ Установка лимитов по категориям
- ✅ Добавление расходов с категориями
- ✅ Просмотр статистики по категориям
- ✅ Доступ ко всем объектам

### Заместитель администратора:
- ✅ Создание категорий (в модальном окне лимита)
- ✅ Установка лимитов по категориям
- ✅ Добавление расходов с категориями
- ✅ Просмотр статистики по категориям
- ✅ Доступ к назначенным объектам

### Менеджер:
- ❌ Создание категорий
- ❌ Установка лимитов
- ✅ Добавление расходов с категориями
- ✅ Просмотр статистики по категориям
- ✅ Доступ только к своим объектам
- ✅ Получает предупреждения о лимитах

### Бухгалтер:
- ❌ Создание категорий
- ❌ Установка лимитов
- ✅ Просмотр всех расходов
- ✅ Просмотр статистики по категориям
- ✅ Доступ ко всем объектам

## 🎨 Дизайн

### Модальное окно "Лимит":
```
┌─────────────────────────────────────────┐
│ Редактировать лимит - Офис А            │
├─────────────────────────────────────────┤
│ Категория расходов: *                   │
│ [Химия, инвентарь, расходники ▼]        │
│                                          │
│ [+ Создать новую категорию]             │
│                                          │
│ Сумма лимита (руб.): *                  │
│ [30000_____]                            │
│                                          │
│ ☑ Повторять каждый месяц                │
│                                          │
│ [Сохранить] [Отмена]                    │
└─────────────────────────────────────────┘
```

### Модальное окно "Расход":
```
┌─────────────────────────────────────────┐
│ Добавить расход - Офис А                │
├─────────────────────────────────────────┤
│ Категория расходов:                     │
│ [Химия, инвентарь, расходники ▼]        │
│                                          │
│ Сумма расхода (руб.): *                 │
│ [5000_______]                           │
│                                          │
│ Описание: *                             │
│ [Моющее средство__________]             │
│                                          │
│ [Добавить] [Отмена]                     │
└─────────────────────────────────────────┘
```

### Модальное окно "Подробно":
```
┌──────────────────────────────────────────────────┐
│ Детальная аналитика расходов - Офис А           │
├──────────────────────────────────────────────────┤
│ [Общее] [По статьям]                             │
├──────────────────────────────────────────────────┤
│ Вкладка "По статьям":                            │
│                                                   │
│ ┌────────────────────────────────────────────┐   │
│ │ 🧪 Химия, инвентарь, расходники            │   │
│ │ Потрачено: 27,000₽  Лимит: 30,000₽        │   │
│ │ Остаток: 3,000₽                            │   │
│ │ [█████████████████░░] 90% ⚠️               │   │
│ │ ⚠️ Лимит почти исчерпан                    │   │
│ └────────────────────────────────────────────┘   │
│                                                   │
│ [Закрыть]                                        │
└──────────────────────────────────────────────────┘
```

## ✅ Преимущества

✅ **Простой интерфейс** - без лишних вкладок на главной странице
✅ **Быстрое создание** - категории создаются прямо в модальном окне
✅ **Автоматический контроль** - проверка лимитов при добавлении расхода
✅ **Детальная аналитика** - разбивка по категориям в одном месте
✅ **Гибкость** - можно добавлять расходы без категории
✅ **Универсальность** - работает для любых объектов

## 🎉 Готово!

Система полностью реализована и готова к использованию:

✅ **3 обновленных модальных окна**
✅ **8 API endpoints**
✅ **Автоматическая проверка лимитов**
✅ **Детальная статистика**
✅ **10 предустановленных категорий**
✅ **Права доступа настроены**

---

**Следующий шаг:** Применить миграцию командами выше и протестировать!
