# üîê –ü–†–ê–í–ê –î–û–°–¢–£–ü–ê –ú–ï–ù–ï–î–ñ–ï–†–û–í - –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–Ø

## üìã **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Ä–æ–ª–∏ MANAGER**

### ‚úÖ **–ß–¢–û –ú–ï–ù–ï–î–ñ–ï–†–´ –ú–û–ì–£–¢ –î–ï–õ–ê–¢–¨:**

#### **üìÇ –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ **–°–≤–æ–∏ –æ–±—ä–µ–∫—Ç—ã** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö, –≥–¥–µ –æ–Ω–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏
- ‚úÖ **–¢–µ—Ö–∫–∞—Ä—Ç—ã** - –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ—Ö–∫–∞—Ä—Ç —Å–≤–æ–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
- ‚úÖ **–ß–µ–∫-–ª–∏—Å—Ç—ã** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ–∫-–ª–∏—Å—Ç–∞–º–∏ —Å–≤–æ–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞—è–≤–∫–∏** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫ –ø–æ —Å–≤–æ–∏–º –æ–±—ä–µ–∫—Ç–∞–º
- ‚úÖ **–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —Å–≤–æ–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ **–§–æ—Ç–æ–æ—Ç—á–µ—Ç—ã** - –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–æ–≤ —Å–≤–æ–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ —Å–≤–æ–∏–º –æ–±—ä–µ–∫—Ç–∞–º

#### **‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á** - –æ—Ç–º–µ—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –≤ —á–µ–∫-–ª–∏—Å—Ç–∞—Ö
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–æ–≤** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –∫ –∑–∞–¥–∞—á–∞–º –∏ –æ–±—ä–µ–∫—Ç–∞–º
- ‚úÖ **–†–∞–±–æ—Ç–∞ —Å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º** - –≤—ã–¥–∞—á–∞ —Å—Ä–µ–¥—Å—Ç–≤, –æ—Ç–º–µ—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞—è–≤–æ–∫** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞—è–≤–æ–∫
- ‚úÖ **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –∑–∞–¥–∞—á–∞–º –∏ –∑–∞—è–≤–∫–∞–º
- ‚úÖ **–û—Ç—á–µ—Ç—ã –æ –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏** - —É–∫–∞–∑–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á

### ‚ùå **–ß–¢–û –ú–ï–ù–ï–î–ñ–ï–†–´ –ù–ï –ú–û–ì–£–¢ –î–ï–õ–ê–¢–¨:**

#### **üö´ –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- ‚ùå **–ß—É–∂–∏–µ –æ–±—ä–µ–∫—Ç—ã** - –Ω–µ –≤–∏–¥—è—Ç –æ–±—ä–µ–∫—Ç—ã –¥—Ä—É–≥–∏—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- ‚ùå **–°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤** - –Ω–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å –æ–±—ä–µ–∫—Ç—ã
- ‚ùå **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ—Ö–∫–∞—Ä—Ç** - –Ω–µ –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ö–∫–∞—Ä—Ç—ã
- ‚ùå **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏** - –Ω–µ –≤–∏–¥—è—Ç –¥—Ä—É–≥–∏—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- ‚ùå **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã** - –Ω–µ –º–æ–≥—É—Ç –Ω–∞–∑–Ω–∞—á–∞—Ç—å —Å–µ–±—è –∏–ª–∏ –¥—Ä—É–≥–∏—Ö
- ‚ùå **–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –Ω–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
- ‚ùå **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –Ω–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** - –Ω–µ –≤–∏–¥—è—Ç –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∏—Å—Ç–µ–º—ã

## üõ°Ô∏è **–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:**

### **1. API —É—Ä–æ–≤–µ–Ω—å:**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –∫–∞–∂–¥–æ–º API —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ
async function checkManagerAccess(userId: string, objectId: string) {
  const object = await prisma.cleaningObject.findFirst({
    where: {
      id: objectId,
      managerId: userId // –ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ —Å–≤–æ–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
    }
  });
  
  if (!object) {
    throw new Error('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω');
  }
  
  return object;
}
```

### **2. UI —É—Ä–æ–≤–µ–Ω—å:**
```typescript
// –£—Å–ª–æ–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
{user.role === 'MANAGER' ? (
  <ManagerDashboard managerId={user.id} />
) : (
  <AdminDashboard />
)}
```

### **3. Database —É—Ä–æ–≤–µ–Ω—å:**
```sql
-- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ managerId
WHERE managerId = $currentUserId
```

## üìä **–ú–ê–¢–†–ò–¶–ê –î–û–°–¢–£–ü–ê:**

| –†–µ—Å—É—Ä—Å | ADMIN | DEPUTY | MANAGER | CLIENT |
|--------|-------|--------|---------|--------|
| **–í—Å–µ –æ–±—ä–µ–∫—Ç—ã** | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| **–°–≤–æ–∏ –æ–±—ä–µ–∫—Ç—ã** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **–¢–µ—Ö–∫–∞—Ä—Ç—ã (–ø—Ä–æ—Å–º–æ—Ç—Ä)** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **–¢–µ—Ö–∫–∞—Ä—Ç—ã (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)** | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| **–ß–µ–∫-–ª–∏—Å—Ç—ã (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞—è–≤–∫–∏** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (–ø—Ä–æ—Å–º–æ—Ç—Ä)** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (–≤—ã–¥–∞—á–∞)** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **–§–æ—Ç–æ–æ—Ç—á–µ—Ç—ã** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏** | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| **–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–≤–æ–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |

## üîß **–¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:**

### **Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤:**
```typescript
// middleware/auth.ts
export function requireManagerAccess(objectId?: string) {
  return async (req: NextRequest) => {
    const user = await getUserFromToken(req);
    
    if (!user) {
      return NextResponse.json({ error: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' }, { status: 401 });
    }
    
    if (user.role === 'ADMIN' || user.role === 'DEPUTY') {
      return null; // –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
    }
    
    if (user.role === 'MANAGER' && objectId) {
      const hasAccess = await checkManagerAccess(user.id, objectId);
      if (!hasAccess) {
        return NextResponse.json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' }, { status: 403 });
      }
    }
    
    return null;
  };
}
```

### **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤:**
```typescript
// components/PermissionGuard.tsx
interface Props {
  role: 'ADMIN' | 'DEPUTY' | 'MANAGER';
  requiredRole?: 'ADMIN' | 'DEPUTY' | 'MANAGER';
  objectId?: string;
  children: React.ReactNode;
}

export function PermissionGuard({ role, requiredRole, objectId, children }: Props) {
  const hasPermission = checkPermission(role, requiredRole, objectId);
  
  if (!hasPermission) {
    return <div>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</div>;
  }
  
  return <>{children}</>;
}
```

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:**

**–ú–µ–Ω–µ–¥–∂–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç:**
- üéØ **–§–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –æ–±—ä–µ–∫—Ç—ã
- ‚ö° **–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø** - –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–¥ —Ä—É–∫–æ–π
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –Ω–µ –º–æ–≥—É—Ç –Ω–∞–≤—Ä–µ–¥–∏—Ç—å —Å–∏—Å—Ç–µ–º–µ
- üìä **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ —Å–≤–æ–∏–º –æ–±—ä–µ–∫—Ç–∞–º

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç:**
- üëÅÔ∏è **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** - –≤–∏–¥—è—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –º–µ–Ω–µ–¥–∂–µ—Ä—ã –Ω–µ –º–æ–≥—É—Ç –≤—ã–π—Ç–∏ –∑–∞ —Ä–∞–º–∫–∏ —Å–≤–æ–∏—Ö –ø–æ–ª–Ω–æ–º–æ—á–∏–π
- üìà **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚öôÔ∏è **–ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–≥—É—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
