require('dotenv').config();
const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

// –î–∞–Ω–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏ –∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
const managersData = [
  {
    name: "–Ø–≥–æ–¥–∞ –ò—Ä–∏–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞",
    phone: "+7 9371782997",
    objects: ["–û–û–û ¬´–ê–ª—å—Ñ–∞¬ª (–¢–¶ –ú–µ–ª–æ–¥–∏—è)", "–ü–ê–û \"–ë—ã—Å—Ç—Ä–æ–ë–∞–Ω–∫\"", "–û–û–û \"–ú–µ–¥–∏—Ü–∏–Ω–∞-–ê–ª—å—Ñ–∞–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è\""]
  },
  {
    name: "–ü–ª–µ–Ω–∫–∏–Ω–∞ –ù–∞—Ç–∞–ª—å—è –ê–ª–µ–∫—Å–µ–µ–≤–Ω–∞", 
    phone: "+7 9874416835",
    objects: ["–û–û–û \"–£–ö –ë–ò–ì-–ë–ï–ù\"", "–û–û–û \"42\"", "–û–û–û ¬´–ù–õ –ö–æ–Ω—Ç–∏–Ω–µ–Ω—Ç¬ª"]
  },
  {
    name: "–ì–∞–π–Ω—É–ª–ª–∏–Ω–∞ –ê–π–Ω–∞ –ê–ª–∏–µ–≤–Ω–∞",
    phone: "+7 9371841382", 
    objects: ["–ê–û ¬´–ì–ö ¬´–≠–ª–µ–∫—Ç—Ä–æ—â–∏—Ç¬ª -–¢–ú –°–∞–º–∞—Ä–∞¬ª", "–û–û–û –ß–û–û ¬´–ì–≤–∞—Ä–¥–µ–µ—Ü¬ª", "–ê–û \"–¢—è–∂–º–∞—à\""]
  },
  {
    name: "–ò—Å–∞–π—á–µ–≤–∞ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞ –ù–∏–∫–æ–ª–∞–µ–≤–Ω–∞",
    phone: "+7 9277576436",
    objects: ["–ê–û ¬´–ì–ö ¬´–≠–ª–µ–∫—Ç—Ä–æ—â–∏—Ç¬ª -–¢–ú –°–∞–º–∞—Ä–∞¬ª", "–û–û–û ¬´–ü–µ–ø—Å–∏–ö–æ –•–æ–ª–¥–∏–Ω–≥—Å¬ª", "–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –§–µ–¥–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ—Å–æ—é–∑–æ–≤ –°–∞–º–∞—Ä—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Å–∞–Ω–∞—Ç–æ—Ä–∏—è ¬´–ö—Ä–∞—Å–Ω–∞—è –ì–ª–∏–Ω–∫–∞¬ª", "–û–û–û \"–ü–ö –§–∞—Ä–∏–∫–∞ –ö–∞—á–µ—Å—Ç–≤–∞\""]
  },
  {
    name: "–®—Ç–µ–ª—å–º–∞—à–µ–Ω–∫–æ –ò—Ä–∏–Ω–∞ –ù–∏–∫–æ–ª–∞–µ–≤–Ω–∞",
    phone: "+7 927 261 8137",
    objects: ["–û–û–û \"–£–ö \"–Æ–≥-—Å–µ—Ä–≤–∏—Å\"", "–ú–ë–£ ¬´–õ–æ–ø–∞—Ç–∏–Ω—Å–∫–æ–µ¬ª", "–û–û–û ¬´–ú–∞—Ä–∫–µ—Ç.–û–ø–µ—Ä–∞—Ü–∏–∏¬ª", "–ò–ü –®–∏—Ä–æ–∫–æ–≤ –î–º–∏—Ç—Ä–∏–π –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á", "–û–û–û \"–ë–¶ \"–°—Ñ–µ—Ä–∞\""]
  },
  {
    name: "–•–∞–ª–∏–¥–æ–≤–∞ –õ–∏–ª–∏—è –ò–ª—å—à–∞—Ç–æ–≤–Ω–∞",
    phone: "+7 937 072 7651",
    objects: ["–û–û–û \"–£–ö \"–Æ–≥-—Å–µ—Ä–≤–∏—Å\"", "–û–û–û \"–ë–¶ \"–°—Ñ–µ—Ä–∞\""]
  },
  {
    name: "–®–æ–¥–∏–µ–≤–∞ –ú—É—Ö–∞—Ä–∞–º(–ì—É–ª—è) –î–∂—É—Ä–∞–µ–≤–Ω–∞",
    phone: "+7 937 980 1704",
    objects: ["–û–û–û \"–£–ö \"–Æ–≥-—Å–µ—Ä–≤–∏—Å\""]
  },
  {
    name: "–ë—É–¥–∫–æ–≤–∞ –°–≤–µ—Ç–ª–∞–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞",
    phone: "+79277406883",
    objects: ["–û–û–û \"–£–ö \"–Æ–≥-—Å–µ—Ä–≤–∏—Å\"", "–û–û–û ¬´–£–ö ¬´–ê–º–æ–Ω–¥-–ñ–∏–ª–ö–æ–º–°–µ—Ä–≤–∏—Å¬ª"]
  },
  {
    name: "–ù–∞–ø–æ–ª—å—Å–∫–∞—è –õ—é–¥–º–∏–ª–∞ –ü–µ—Ç—Ä–æ–≤–Ω–∞",
    phone: "+7 9370715422",
    objects: ["–û–ê–û \"–°–∞–º–∞—Ä—Å–∫–∏–π —Ö–ª–µ–±–æ–∑–∞–≤–æ–¥ ‚Ññ5\""]
  },
  {
    name: "–õ–∞—Å–∫–∏–Ω –ü–∞–≤–µ–ª –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á",
    phone: "+79277570553",
    objects: ["–û–û–û ¬´–ü–µ–ø—Å–∏–ö–æ –•–æ–ª–¥–∏–Ω–≥—Å¬ª"]
  },
  {
    name: "–í–∞—Å–µ–∫–∏–Ω –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á",
    phone: "+7 927 716 5189",
    objects: ["–û–û–û ¬´–ü–µ–ø—Å–∏–ö–æ –•–æ–ª–¥–∏–Ω–≥—Å\"", "–û–û–û \"–ñ–∏–ª–≠–Ω–µ—Ä–≥–æ\"", "–¢–°–ñ \"–°–ø–∞—Ä—Ç–∞–∫\"", "–ê–û \"–†–æ—Å–∂–µ–ª–¥–æ—Ä–ø—Ä–æ–µ–∫—Ç\"", "–û–û–û \"–≠–ª–µ–∫—Ç—Ä–æ—â–∏—Ç-–ò–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥\"", "–û–û–û \"–ï–¢–≠–°\"", "–ü–ê–û ¬´–°–∞–º–∞—Ä–∞—ç–Ω–µ—Ä–≥–æ¬ª", "–û–û–û \"–§–õ–ê–ì–ú–ê–ù\""]
  },
  {
    name: "–ì–∞–ª–∏–µ–≤ –†—É—Å—Ç–∞–º –†–∞—Ñ–∏–∫–æ–≤–∏—á",
    phone: "+7 967 722 8013",
    objects: ["–û–û–û \"–ñ–∏–ª–≠–Ω–µ—Ä–≥–æ\"", "–§–ì–ë–û–£ –í–û –°–∞–º–ì–ú–£ –ú–∏–Ω–∑–¥—Ä–∞–≤–∞ –†–æ—Å—Å–∏–∏"]
  },
  {
    name: "–ö–æ–±–∑–µ–≤–∞ –ê–Ω–Ω–∞ –í—è—á–µ—Å–ª–∞–≤–æ–≤–Ω–∞",
    phone: "+7 9279035948",
    objects: ["–û–û–û ¬´–ò–Ω–∫–∞—Ç–µ—Ö¬ª"]
  },
  {
    name: "–ù—É–≤–∞–ª—å—Ü–µ–≤–∞ –ú–∞—Ä–∏—è –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞",
    phone: "+7 9179582793",
    objects: ["–û–û–û ¬´–ò–Ω–∫–∞—Ç–µ—Ö¬ª"]
  },
  {
    name: "–ì–æ—Ä–¥–µ–µ–≤ –†–æ–º–∞–Ω –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á",
    phone: "+7 987 955 1196",
    objects: ["–û–û–û ¬´–ú–∞—Ä–∫–µ—Ç.–û–ø–µ—Ä–∞—Ü–∏–∏¬ª"]
  },
  {
    name: "–°–æ–∫–æ–ª–æ–≤–∞ –û–ª—å–≥–∞ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–≤–Ω–∞",
    phone: "+7 9170173062",
    objects: ["–§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–µ –∫–∞–∑–µ–Ω–Ω–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ ¬´–¶–µ–Ω—Ç—Ä —Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ì–ª–∞–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–µ–ª –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ –ø–æ –°–∞–º–∞—Ä—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏¬ª"]
  },
  {
    name: "–¢–∏–º–æ—Ö–∏–Ω–∞ –ê–Ω–Ω–∞ –ê–Ω–∞—Ç–æ–ª—å–µ–≤–Ω–∞",
    phone: "+7 919 803 0999",
    objects: ["–ê–û \"–¢—è–∂–º–∞—à\""]
  },
  {
    name: "–ö—Ä–∞–ø–∏–≤–∫–æ –õ–∞—Ä–∏—Å–∞ –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞",
    phone: "+7 987 987 3566",
    objects: ["–û–û–û \"–ü–ö –§–∞—Ä–∏–∫–∞ –ö–∞—á–µ—Å—Ç–≤–∞\""]
  },
  {
    name: "–ë–æ–±—Ä–æ–≤—Å–∫–∞—è –ï–ª–µ–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞",
    phone: "+7 937 994 9424",
    objects: ["–û–û–û ¬´–ù–µ–∫—Ç–∞—Ä¬ª"]
  },
  {
    name: "–ë—Ä–∞–≥–∏–Ω–∞ –ö–∞—Ç–µ—Ä–∏–Ω–∞ –Æ—Ä—å–µ–≤–Ω–∞",
    phone: "+7 917 976 2778",
    objects: ["–ó–ê–û ¬´–°–ë–ö–ö¬ª"]
  }
];

async function updateManagersWithPhones() {
  try {
    console.log('üìû –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤...');
    
    let updated = 0;
    let created = 0;
    let errors = 0;

    for (const managerData of managersData) {
      try {
        console.log(`\nüë§ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º: ${managerData.name}`);
        console.log(`üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${managerData.phone}`);
        
        // –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–æ –∏–º–µ–Ω–∏
        let manager = await prisma.user.findFirst({
          where: {
            name: managerData.name,
            role: 'MANAGER'
          }
        });

        if (manager) {
          // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
          await prisma.user.update({
            where: { id: manager.id },
            data: { phone: managerData.phone }
          });
          console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞`);
          updated++;
        } else {
          // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
          const email = managerData.name.toLowerCase()
            .replace(/[^a-z–∞-—è0-9]/g, '')
            .substring(0, 20) + '@cleaning.local';
          
          manager = await prisma.user.create({
            data: {
              name: managerData.name,
              email: email,
              phone: managerData.phone,
              password: '$2b$10$defaultpasswordhash', // –í—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
              role: 'MANAGER'
            }
          });
          console.log(`‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å email: ${email}`);
          created++;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ä–µ–∫—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞
        console.log(`üè¢ –û–±—ä–µ–∫—Ç–æ–≤ –≤ —Å–ø–∏—Å–∫–µ: ${managerData.objects.length}`);
        
      } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ ${managerData.name}:`, error.message);
        errors++;
      }
    }

    console.log('\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:');
    console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${updated}`);
    console.log(`üÜï –°–æ–∑–¥–∞–Ω–æ: ${created}`);
    console.log(`‚ùå –û—à–∏–±–æ–∫: ${errors}`);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏
    console.log('\nüìã –ò—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤:');
    const allManagers = await prisma.user.findMany({
      where: { role: 'MANAGER' },
      select: {
        id: true,
        name: true,
        phone: true,
        email: true,
        _count: {
          select: {
            managedObjects: true
          }
        }
      },
      orderBy: { name: 'asc' }
    });

    allManagers.forEach((manager, index) => {
      console.log(`${index + 1}. ${manager.name}`);
      console.log(`   üìû ${manager.phone || '–ù–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞'}`);
      console.log(`   üìß ${manager.email}`);
      console.log(`   üè¢ –û–±—ä–µ–∫—Ç–æ–≤: ${manager._count.managedObjects}`);
    });

    console.log(`\n‚úÖ –í—Å–µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ: ${allManagers.length}`);

  } catch (error) {
    console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);
  } finally {
    await prisma.$disconnect();
  }
}

updateManagersWithPhones();
